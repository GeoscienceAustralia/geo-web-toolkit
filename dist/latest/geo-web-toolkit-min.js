var angular=angular||{};var jQuery=jQuery||{};var console=console||{};var app=angular.module("gawebtoolkit.config",[]);app.directive("gaMapConfig",["$compile","$http","$q","$interpolate","$timeout","$parse","$log",function(c,h,a,g,b,d,f){return{restrict:"E",scope:true,controller:["$scope","$element","$attrs",function(k,j,i){k.loadConfigData=function(){var l;if(i.configValue!=null){k.configLocal=true}if(i.gaConfigPath!=null&&i.gaConfigPath.indexOf("{{")!==-1){l=k.$eval(g(i.gaConfigPath))}else{l=i.gaConfigPath}if(i.staticConfig==="true"){l=l+".json"}var n=function(p){f.info("config http request success");if(p){f.info("config http request data present")}if(i.preConfig){var q=d(i.preConfig);k.gaConfigTemp=q(k,{config:p})}else{k.gaConfigTemp=p}k.$emit("configDataLoaded",k.gaConfigTemp);k.$broadcast("configDataLoaded",k.gaConfigTemp);if(i.postConfig){var o=d(i.postConfig);o(k,{config:k.gaConfigTemp})}};f.info("config loading...");var m=function(q,o,r,p){f.error("Failed to load config - "+o)};if(l!=null&&l.length>0){h({method:"GET",url:l}).success(n).error(m)}if(k.configLocal){b(function(){n(k.$eval(i.configValue))},1000)}}}],compile:function e(n,l){var m;var j;if(l.templatePath!=null){var k=a.defer();h.get(l.templatePath).success(function(p){j=c(p);k.resolve(j)});m=k.promise}return{post:function i(r,q,p){},pre:function o(r,q,p){m.then(function(s){q.html(s(r));r.loadConfigData()})}}}}}]);var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var app=angular.module("gawebtoolkit.core.control-directives",["gawebtoolkit.core.map-directives","gawebtoolkit.core.map-services","gawebtoolkit.core.layer-services"]);app.directive("gaMapControl",[function(){return{restrict:"E",require:"^gaMap",scope:{mapControlName:"@",mapControlId:"@",controlOptions:"=",containerElementId:"@",preOptionsLoaded:"&",controlEnabled:"@"},link:function(c,b,a,d){if(!c.mapControlName){return}var e=c.preOptionsLoaded({options:c.controlOptions});c.controlOptions=e===undefined?c.controlOptions:e;c.controlDto=d.addControl(c.mapControlName,c.controlOptions,c.containerElementId,c.mapControlId);if(a.controlEnabled!=null){a.$observe("controlEnabled",function(){if(c.controlEnabled==="true"){d.activateControl(c.controlDto.id)}else{d.deactivateControl(c.controlDto.id)}})}}}}]);var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var jQuery=jQuery||{};angular.module("gawebtoolkit.core",["gawebtoolkit.mapservices","gawebtoolkit.core.map-directives","gawebtoolkit.core.map-services","gawebtoolkit.core.layer-directives","gawebtoolkit.vendor-layers","gawebtoolkit.core.layer-services","gawebtoolkit.core.data-services","gawebtoolkit.core.control-directives","gawebtoolkit.core.feature-directives","gawebtoolkit.core.marker-directives","gawebtoolkit.core.map-config","gawebtoolkit.utils"]);var angular=angular||{};var OpenLayers=OpenLayers||{};var ol=ol||{};var app=angular.module("gawebtoolkit.core.data-services",["gawebtoolkit.mapservices"]);app.service("GADataService",["$log","ga.config","dataServiceLocator",function(c,a,b){return{getLayersByWMSCapabilities:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.getLayersByWMSCapabilities(f)},getWMSFeatures:function(e,d,j,g,f,k,i){var l=i||"olv2";var h=b.getImplementation(l);return h.getWMSFeatures(e,d,j,g,f,k)},getWMSFeaturesByLayerId:function(h,i,g,e,f){var j=f||"olv2";var d=b.getImplementation(j);return d.getLayersByWMSCapabilities(h,i,g,e)}}}]);app.service("dataServiceLocator",["$injector",function(b){var a={olv2:"olv2DataService",olv3:"olv3DataService"};return{getImplementation:function(c){return b.get(a[c])}}}]);var angular=angular||{};var app=angular.module("gawebtoolkit.core.feature-directives",["gawebtoolkit.core.map-directives","gawebtoolkit.core.map-services","gawebtoolkit.core.layer-services"]);app.directive("gaFeatureLayer",["$timeout","$compile","$q","GALayerService",function(d,c,b,a){return{restrict:"E",require:"^gaMap",scope:{url:"@",layerName:"@",visibility:"@",projection:"@",controllerEmitEventName:"@",postAddLayer:"&",onLayerDestroy:"&"},controller:["$scope",function(f){f.layerControllerIsReady=false;f.gaFeatures=[];f.featurePromises=[];var e=this;e.hide=function(){f.mapAPI.mapController.setLayerVisibility(f.layerDto.id,false);return e};e.show=function(){f.mapAPI.mapController.setLayerVisibility(f.layerDto.id,true);return e};e.setOpacity=function(h){f.mapAPI.mapController.setOpacity(f.layerDto.id,h);return e};e.getFeatures=function(){return f.mapAPI.mapController.getLayerFeatures(f.layerDto.id)};e.addFeature=function(j){if(j.then!==null&&typeof j.then==="function"){if(f.layerControllerIsReady){j.then(function(k){f.mapAPI.mapController.addFeatureToLayer(f.layerDto.id,k)})}else{f.featurePromises.push(j)}return j}else{var i=b.defer();if(f.layerControllerIsReady){var h=f.mapAPI.mapController.addFeatureToLayer(f.layerDto.id,j);g(i,h)}else{f.featurePromises.push(i.promise);g(i,j)}return i.promise}};var g=function(h,i){d(function(){h.resolve(i)})};e.createFeatureAsync=function(j,h){var i=b.defer();f.gaFeatures.push({deferred:i,feature:j,isLonLatOrderValid:h});return i.promise};e.createFeature=function(h){return f.mapAPI.mapController.createFeature(h)};e.removeFeature=function(h){f.mapAPI.mapController.removeFeatureFromLayer(f.layerDto.id,h)};e.isLayerControllerReady=function(){return f.layerControllerIsReady};if(f.controllerEmitEventName){f.$emit(f.controllerEmitEventName,e)}return e}],transclude:false,link:function(e,h,f,j){e.mapAPI={};e.mapAPI.mapController=j;var i=a.defaultLayerOptions(f,j.getFrameworkVersion());i.datumProjection=e.projection||j.getProjection();i.postAddLayer=e.postAddLayer;var g=a.createFeatureLayer(i,j.getFrameworkVersion());j.addLayer(g).then(function(k){e.layerDto=k;e.layerControllerIsReady=true;b.all(e.featurePromises).then(function(l){for(var n=0;n<l.length;n++){var m=l[n];j.addFeatureToLayer(e.layerDto.id,m)}})});e.$on("$destroy",function(){if(e.layerDto.id!=null){e.onLayerDestroy({map:j.getMapInstance()})}d(function(){a.cleanupLayer(j.getMapInstance(),e.layerDto.id)})});f.$observe("visibility",function(k){if(e.layerDto!=null){j.setLayerVisibility(e.layerDto.id,k)}})}}}]);app.directive("gaFeature",[function(){return{restrict:"E",require:"^gaFeatureLayer",scope:{visibility:"@",geoJsonFeature:"=",inputFormat:"@",isLonLatOrderValid:"@"},transclude:false,link:function(a,d,c,b){var f=true;var e=function(h,g){if(!h&&g){b.removeFeature(a.featureDto.id)}if(h&&h!==g){if(a.featureDto!=null&&a.featureDto.id.length>0){b.removeFeature(a.featureDto.id)}f=false;var i=b.createFeature(a.geoJsonFeature);b.addFeature(i).then(function(k){a.featureDto=k})}if(h&&f){var j=b.createFeature(a.geoJsonFeature);f=false;b.addFeature(j).then(function(k){a.featureDto=k})}};a.$on("$destroy",function(){if(a.featureDto!=null){b.removeFeature(a.featureDto.id)}if(a.geoJsonFeatureWatch!=null){a.geoJsonFeatureWatch()}});a.geoJsonFeatureWatch=a.$watch("geoJsonFeature",e)}}}]);var angular=angular||{};var $=$||{};var app=angular.module("gawebtoolkit.core.layer-directives",["gawebtoolkit.core.map-directives","gawebtoolkit.core.layer-services","gawebtoolkit.core.map-services"]);app.directive("gaMapLayer",["$timeout","$compile","GALayerService","$log",function(c,b,a,d){return{restrict:"E",require:"^gaMap",scope:{layerAttribution:"@",layerName:"@",layerUrl:"@",layers:"@",layerType:"@",wrapDateLine:"@",visibility:"@",isBaseLayer:"@",opacity:"@",controllerEmitEventName:"@",refreshLayer:"@",maxZoomLevel:"@",minZoomLevel:"@",onError:"&",format:"@"},transclude:false,controller:["$scope",function(f){var e=this;e.hide=function(){f.mapAPI.mapController.setLayerVisibility(f.layerDto.id,false);return e};e.show=function(){f.mapAPI.mapController.setLayerVisibility(f.layerDto.id,true);return e};e.setOpacity=function(g){f.mapAPI.mapController.setOpacity(f.layerDto.id,g);return e};if(f.controllerEmitEventName){f.$emit(f.controllerEmitEventName,e)}return e}],link:function(n,i,m,e){n.framework=e.getFrameworkVersion();m.$observe("refreshLayer",function(p,o){if(p!==o){d.info("refresh for - "+n.layerName);n.initialiseLayer()}});n.mapAPI={};n.mapAPI.mapController=e;var k,j;var l=function(){n.layerReady=true};function g(){if(m.layers==null){m.layers="0"}if(m.wrapDateLine==null){m.wrapDateLine=true}if(m.visibility==null){m.visibility=true}if(m.layerType==null||m.layerType.length===0){if(m.layerUrl.indexOf("WMSServer")>0){m.layerType="WMS"}}}var h=function(){g();n.constructionInProgress=true;k=a.defaultLayerOptions(m,n.framework);k.initialExtent=e.getInitialExtent();k.mapElementId=e.getMapElementId();k.format=n.format;d.info(k.layerName+" - constructing...");if(k.layerType.length===0){return}j=a.createLayer(k,n.framework);e.addLayer(j).then(function(o){n.layerDto=o;l();d.info("construction complete...");n.constructionInProgress=false},function(o){n.$emit(k.layerName+"_error",k);n.onError({message:o,layer:k});l();d.info("construction failed...");n.constructionInProgress=false})};m.$observe("visibility",function(){if(n.layerReady&&e&&n.layerDto!=null&&n.layerDto.id){e.setLayerVisibility(n.layerDto.id,n.visibility==="true")}});m.$observe("opacity",function(){if(n.layerReady&&e&&n.layerDto!=null&&n.layerDto.id){e.setOpacity(n.layerDto.id,n.opacity)}});n.initCount=0;function f(){d.info("reconstructing layer...");var o=e.getLayers();var q=null;for(var p=0;p<o.length;p++){if(o[p].id===n.layerDto.id){q=p;break}}if(q!=null){e.removeLayerById(n.layerDto.id);n.layerDto=null;g();k=a.defaultLayerOptions(m,n.framework);k.initialExtent=e.getInitialExtent();k.format=n.format;j=a.createLayer(k,n.framework);e.addLayer(j).then(function(r){n.layerDto=r;l();if(n.layerDto!=null){var s=q-e.getLayers().length+1;e.raiseLayerDrawOrder(n.layerDto.id,s)}})}}n.initialiseLayer=function(){d.info("initialising layer...");if(n.layerDto!=null){f()}else{if(n.layerReady&&n.constructionInProgress){d.info("...")}else{h()}}};n.$on("$destroy",function(){if(n.layerDto){e.removeLayerById(n.layerDto.id)}$(window).off("resize.Viewport")});if(m.refreshLayer==null&&n.layerType!=null&&n.layerType.length>0){n.initialiseLayer()}}}}]);var angular=angular||{};var OpenLayers=OpenLayers||{};var ol=ol||{};var app=angular.module("gawebtoolkit.core.layer-services",["gawebtoolkit.mapservices"]);app.service("GALayerService",["ga.config","mapLayerServiceLocator",function(b,a){return{createLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createLayer(e)},createFeatureLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createFeatureLayer(e)},createGoogleLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createGoogleLayer(e)},createBingLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createBingLayer(e)},createOsmLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createOsmLayer(e)},createMarkerLayer:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.createMarkerLayer(e)},removeLayerByName:function(e,f,d){var g=d||"olv2";var c=a.getImplementation(g);c.removeLayerByName(e,f)},removeLayersByName:function(e,f,d){var g=d||"olv2";var c=a.getImplementation(g);c.removeLayersByName(e,f)},removeLayer:function(e,f,d){var g=d||"olv2";var c=a.getImplementation(g);c.removeLayer(e,f)},removeLayerById:function(f,e,d){var g=d||"olv2";var c=a.getImplementation(g);c.removeLayerById(f,e)},getMarkerCountForLayerName:function(e,f,d){var g=d||"olv2";var c=a.getImplementation(g);return c.getMarkerCountForLayerName(e,f)},registerFeatureSelected:function(f,e,i,g,d){var h=d||"olv2";var c=a.getImplementation(h);return c.registerFeatureSelected(f,e,i,g)},defaultLayerOptions:function(e,d){var f=d||"olv2";var c=a.getImplementation(f);return c.defaultLayerOptions(e,new b())},createFeature:function(f,d,e){var g=e||"olv2";var c=a.getImplementation(g);return c.createFeature(f,d)},cleanupLayer:function(f,e,d){var g=d||"olv2";var c=a.getImplementation(g);return c.cleanupLayer(f,e)},registerLayerEvent:function(g,e,f,i,d){var h=d||"olv2";var c=a.getImplementation(h);c.registerLayerEvent(g,e,f,i)},unRegisterMapEvent:function(g,e,f,i,d){var h=d||"olv2";var c=a.getImplementation(h);c.unRegisterMapEvent(g,e,f,i)},addFeatureToLayer:function(f,e,g,d){var h=d||"olv2";var c=a.getImplementation(h);return c.addFeatureToLayer(f,e,g)},parselatLong:function(c){if(!c){return null}var e,d;e=c.split(",");d={lat:"",lon:""};d.lat=e[0];d.lon=e[1];return d},filterFeatureLayer:function(g,e,i,f,d){var h=d||"olv2";var c=a.getImplementation(h);c.filterFeatureLayer(g,e,i,f)},getLayerFeatures:function(f,e,d){var g=d||"olv2";var c=a.getImplementation(g);return c.getLayerFeatures(f,e)},removeFeatureFromLayer:function(f,e,g,d){var h=d||"olv2";var c=a.getImplementation(h);return c.removeFeatureFromLayer(f,e,g)},raiseLayerDrawOrder:function(f,e,h,d){var g=d||"olv2";var c=a.getImplementation(g);return c.raiseLayerDrawOrder(f,e,h)}}}]);app.service("mapLayerServiceLocator",["$injector",function(b){var a={olv2:"olv2LayerService",olv3:"olv3LayerService"};return{getImplementation:function(c){return b.get(a[c])}}}]);var angular=angular||{};var OpenLayers=OpenLayers||{};var app=angular.module("gawebtoolkit.core.map-config",[]);app.value("ga.config",function(){var a={standardTileSize:256,largeTileSize:1024,veryLargeTileSize:2048,minMapWidth:900,minMapHeight:600,panIncrement:30,smallPanIncrement:5,transitionEffect:"resize",visibility:true,isBaseLayer:false,wrapDateLine:true,sphericalMercator:true,bingLayerType:"Road",opacity:1,layerAttribution:"",displayInLayerSwitcher:true,projection:"EPSG:102100",displayProjection:"EPSG:4326",numZoomLevels:15,transparent:true,format:"image/png",tileSize:function(c){var b;if(c){if(c==="large"){b=new OpenLayers.Size(a.largeTileSize,a.largeTileSize)}else{if(c==="vlarge"){b=new OpenLayers.Size(a.veryLargeTileSize,a.veryLargeTileSize)}}}else{b=new OpenLayers.Size(a.standardTileSize,a.standardTileSize)}return b},layerType:"WMS"};return{defaultOptions:a,olv2Options:a,cesiumOptions:{includeCustomTerrainProvider:false,customTerrainProviderUrl:null},olv3Options:{renderer:"canvas"}}});var angular=angular||{};var $=$||{};var app=angular.module("gawebtoolkit.core.map-directives",["gawebtoolkit.core.map-services","gawebtoolkit.core.layer-services"]);app.directive("gaMap",["$timeout","$compile","GAMapService","GALayerService","GADataService","$q","$log",function(d,c,g,a,f,b,e){return{restrict:"E",scope:{mapElementId:"@",datumProjection:"@",displayProjection:"@",centerPosition:"@",zoomLevel:"@",isStaticMap:"@",initialExtent:"=",framework:"@"},controller:["$scope",function(i){e.info("map creation started...");$("#"+i.mapElementId).empty();i.initialPositionSet=false;i.layerPromises=[];i.layerDtoPromises=[];var h=this;h.addLayer=function(l){var n=b.defer();var k=b.defer();if(l.then!==null&&typeof l.then==="function"){n=l;if(i.layersReady){l.then(function(o){if(o==null){e.info("failed to load layer")}else{var p=g.addLayer(i.mapInstance,o,i.framework);k.resolve(p);i.$emit("layerAdded",p)}})}else{i.layerPromises.push(n);i.layerDtoPromises.push(k)}}else{if(i.layersReady){var m=g.addLayer(i.mapInstance,l,i.framework);k.resolve(m);i.$emit("layerAdded",m)}else{i.layerPromises.push(n.promise);i.layerDtoPromises.push(k);n.resolve(l)}}return k.promise};var j=[];i.deferredMarkers=[];h.addMarkerLayer=function(n,q){if(!q){return h.addLayer(n)}else{j.push(q);var p=false;var l;for(var m=0;m<j.length;m++){l=j[m];if(l===q){p=true;break}}if(!p){return h.addLayer(n)}else{if(!i.layersReady){var o=b.defer();i.deferredMarkers.push(o);return o.promise}else{var k=b.defer();k.resolve();return k.promise}}}};h.getMapOptions=function(){return{mapElementId:i.mapElementId,datumProjection:i.datumProjection,displayProjection:i.displayProjection,centerPosition:i.centerPosition,zoomLevel:i.zoomLevel,initialExtent:i.initialExtent}};h.createLayer=function(k){var l=a.defaultLayerOptions(k,i.framework);return a.createLayer(l,i.framework)};h.zoomToMaxExtent=function(){g.zoomToMaxExtent(i.mapInstance,i.framework)};h.currentZoomLevel=function(){return g.currentZoomLevel(i.mapInstance,i.framework)};h.registerMapMouseMove=function(k){g.registerMapMouseMove(i.mapInstance,k,i.framework)};h.registerMapMouseMoveEnd=function(k){g.registerMapMouseMoveEnd(i.mapInstance,k,i.framework)};h.registerMapClick=function(k){g.registerMapClick(i.mapInstance,k,i.framework)};h.unRegisterMapClick=function(k){g.unRegisterMapClick(i.mapInstance,k,i.framework)};h.addControl=function(m,n,k,l){return g.addControl(i.mapInstance,m,n,k,l,h.getMapOptions(),i.framework)};h.getLonLatFromPixel=function(l,m,k){return g.getLonLatFromPixel(i.mapInstance,l,m,k,i.framework)};h.getPixelFromLonLat=function(l,k){return g.getPixelFromLonLat(i.mapInstance,l,k,i.framework)};h.getPointFromEvent=function(k){return g.getPointFromEvent(k,i.framework)};h.getLayers=function(){return g.getLayers(i.mapInstance,i.framework)};h.getLayersByName=function(k){return g.getLayersByName(i.mapInstance,k,i.framework)};h.zoomToLayer=function(k){g.zoomToLayer(i.mapInstance,k,i.framework)};h.getProjection=function(){return i.datumProjection};h.getDisplayProjection=function(){return i.displayProjection};h.setLayerVisibility=function(l,k){g.setLayerVisibility(i.mapInstance,l,k,i.framework)};h.createBoundingBox=function(k){return g.createBoundingBox(i.mapInstance,k,i.framework)};h.createBounds=function(l,k){return g.createBounds(i.mapInstance,l,k,i.framework)};h.zoomToExtent=function(k){g.zoomToExtent(i.mapInstance,k,i.framework)};h.zoomTo=function(k){g.zoomTo(i.mapInstance,k,i.framework)};h.setBaseLayer=function(k){g.setBaseLayer(i.mapInstance,k,i.framework)};h.setCenter=function(l,m,k){g.setCenter(i.mapInstance,l,m,k,i.framework)};h.getInitialExtent=function(){return i.initialExtent};h.setInitialPositionAndZoom=function(){var k={mapElementId:i.mapElementId,datumProjection:i.datumProjection,displayProjection:i.displayProjection,centerPosition:i.centerPosition,zoomLevel:i.zoomLevel,initialExtent:i.initialExtent};if(!i.centerPosition){i.centerPosition={lon:0,lat:0}}if(!i.initialPositionSet){g.setInitialPositionAndZoom(i.mapInstance,k,i.framework)}i.initialPositionSet=true};h.isBaseLayer=function(k){return g.isBaseLayer(i.mapInstance,k,i.framework)};h.getMapInstance=function(){return i.mapInstance};h.setOpacity=function(k,l){g.setOpacity(i.mapInstance,k,l,i.framework)};h.getMapElementId=function(){return i.mapElementId};h.setMapMarker=function(k,n,m,l){return g.setMapMarker(i.mapInstance,k,n,m,l,i.framework)};h.removeMapMarker=function(k){g.removeMapMarker(i.mapInstance,k,i.framework)};h.removeLayerByName=function(k){a.removeLayerByName(i.mapInstance,k,i.framework)};h.removeLayersByName=function(k){a.removeLayersByName(i.mapInstance,k,i.framework)};h.removeLayer=function(k){a.removeLayer(i.mapInstance,k,i.framework)};h.removeLayerById=function(k){a.removeLayerById(i.mapInstance,k,i.framework)};h.getMarkerCountForLayerName=function(k){return a.getMarkerCountForLayerName(i.mapInstance,k,i.framework)};h.drawPolyLine=function(l,k){g.drawPolyLine(i.mapInstance,l,k,i.framework)};h.startRemoveSelectedFeature=function(k){return g.startRemoveSelectedFeature(i.mapInstance,k,i.framework)};h.stopRemoveSelectedFeature=function(){return g.stopRemoveSelectedFeature(i.mapInstance,i.framework)};h.removeFeature=function(k,l){return g.removeFeature(i.mapInstance,k,l,i.framework)};h.startDrawingOnLayer=function(l,k){return g.startDrawingOnLayer(i.mapInstance,l,k,i.framework)};h.stopDrawing=function(){return g.stopDrawing(i.mapInstance,i.framework)};h.drawLabel=function(l,k){return g.drawLabel(i.mapInstance,l,k,i.framework)};h.drawLabelWithPoint=function(l,k){return g.drawLabelWithPoint(i.mapInstance,l,k,i.framework)};h.isControlActive=function(k,l){return g.isControlActive(i.mapInstance,k,l,i.framework)};h.getLayersByWMSCapabilities=function(k){return f.getLayersByWMSCapabilities(k,i.framework)};h.getWMSFeatures=function(k,m,o,l,n){return f.getWMSFeatures(i.mapInstance,k,m,o,l,n,i.framework)};h.getWMSFeaturesByLayerId=function(l,k,m){return f.getWMSFeaturesByLayerId(i.mapInstance,l,k,m,i.framework)};h.registerFeatureSelected=function(k,m,l){return a.registerFeatureSelected(i.mapInstance,k,m,l,i.framework)};h.getFeatureInfo=function(q,m,o,n,p,k,l){return g.getFeatureInfo(i.mapInstance,q,m,o,n,p,k,l,i.framework)};h.getFeatureInfoFromLayer=function(n,l,k,m){return g.getFeatureInfoFromLayer(i.mapInstance,n,l,k,m,i.framework)};h.resetMapFired=function(){i.$emit("resetMapFired")};h.activateControl=function(k){g.activateControl(i.mapInstance,k,i.framework)};h.deactivateControl=function(k){g.deactivateControl(i.mapInstance,k,i.framework)};h.registerControlEvent=function(l,k,m){g.registerControlEvent(i.mapInstance,l,k,m,i.framework)};h.unRegisterControlEvent=function(l,k,m){g.unRegisterControlEvent(i.mapInstance,l,k,m,i.framework)};h.registerMapEvent=function(k,l){g.registerMapEvent(i.mapInstance,k,l,i.framework)};h.registerLayerEvent=function(k,l,m){a.registerLayerEvent(i.mapInstance,k,l,m,i.framework)};h.unRegisterLayerEvent=function(k,l,m){a.unRegisterLayerEvent(i.mapInstance,k,l,m,i.framework)};h.unRegisterMapEvent=function(k,l){g.unRegisterMapEvent(i.mapInstance,k,l,i.framework)};h.getCurrentMapExtent=function(){return g.getCurrentMapExtent(i.mapInstance,i.framework)};h.switch3d=function(){if(!g.is3dSupported(i.mapInstance,i.framework)){return}if(!g.is3d(i.mapInstance,i.framework)){g.switchTo3dView(i.mapInstance,i.framework)}else{g.switchTo2dView(i.mapInstance,i.framework)}};h.is3d=function(){if(!g.is3dSupported(i.mapInstance,i.framework)){return false}return g.is3d(i.mapInstance,i.framework)};h.filterFeatureLayer=function(k,m,l){a.filterFeatureLayer(i.mapInstance,k,m,l,i.framework)};h.getLayerFeatures=function(k){return a.getLayerFeatures(i.mapInstance,k,i.framework)};h.createFeature=function(k){return a.createFeature(i.mapInstance,k,i.framework)};h.addFeatureToLayer=function(k,l){return a.addFeatureToLayer(i.mapInstance,k,l,i.framework)};h.createWfsClient=function(m,p,o,l,q,n,k){return g.createWfsClient(m,p,o,l,q,n,k,i.framework)};h.addWfsClient=function(k){return g.addWfsClient(k,i.framework)};h.searchWfs=function(k,m,l){return g.searchWfs(i.mapInstance,k,m,l,i.framework)};h.getMeasureFromEvent=function(k){return g.getMeasureFromEvent(i.mapInstance,k,i.framework)};h.removeFeatureFromLayer=function(k,l){a.removeFeatureFromLayer(i.mapInstance,k,l,i.framework)};h.raiseLayerDrawOrder=function(k,l){a.raiseLayerDrawOrder(i.mapInstance,k,l,i.framework)};h.getFrameworkVersion=function(){return i.framework};i.gaMap=h;$(window).bind("resize",function(){g.mapResized(i.mapInstance,i.framework)});i.mapInstance=g.initialiseMap({mapElementId:i.mapElementId,datumProjection:i.datumProjection,displayProjection:i.displayProjection,initialExtent:i.initialExtent,centerPosition:i.centerPosition,zoomLevel:i.zoomLevel,isStaticMap:i.isStaticMap},i.framework);i.$emit("mapInstanceReady",i.mapInstance);i.$emit("mapControllerReady",h);i.$broadcast("mapControllerReady",h);i.$on("$destroy",function(){e.info("map destruction started...");$(window).off("resize.Viewport");d(function(){e.info("map destruction finishing...");e.info("removing "+i.gaMap.getLayers().length+" layers...");var m=i.gaMap.getLayers();for(var l=0;l<m.length;l++){var k=m[l];i.gaMap.removeLayerById(k.id)}})})}],link:function(k,j,i){d(function(){b.allSettled(k.layerPromises).then(function(l){h(l)},function(l){h(l)})});function h(q){e.info("resolving all layers");var l=[];for(var n=0;n<q.length;n++){var m=q[n];if(typeof m==="string"){k.layerDtoPromises[n].reject(m)}else{var p=g.addLayer(k.mapInstance,m,k.framework);k.layerDtoPromises[n].resolve(p);l.push(p)}}for(var o=0;o<k.deferredMarkers.length;o++){k.deferredMarkers[o].resolve()}k.$emit("layersReady",l);k.$broadcast("layersReady",l);k.layersReady=true;k.gaMap.setInitialPositionAndZoom()}},transclude:false}}]);app.config(["$provide",function(a){a.decorator("$q",["$delegate",function(c){var b=c;b.allSettled=b.allSettled||function(h){var f=b.defer();if(angular.isArray(h)){var e=[];var g=[];var d=false;angular.forEach(h,function(k,j){e[j]=false});var i=function(l,m,k,j){var n=true;angular.forEach(l,function(o){if(!o){n=false}});if(n){if(j){k.reject(m)}else{k.resolve(m)}}};angular.forEach(h,function(k,j){b.when(k).then(function(l){e[j]=true;g[j]=l;i(e,g,f,d)},function(l){e[j]=true;g[j]=l;d=true;i(e,g,f,d)})})}else{throw"allSettled can only handle an array of promises (for now)"}return f.promise};return b}])}]);var angular=angular||{};var OpenLayers=OpenLayers||{};var ol=ol||{};var app=angular.module("gawebtoolkit.core.map-services",["gawebtoolkit.mapservices"]);app.service("GAMapService",["$log","ga.config","mapServiceLocator",function(c,a,b){return{initialiseMap:function(g,f){var i=f||"olv2";var d=b.getImplementation(i);try{return d.initialiseMap(g,new a())}catch(h){c.error("Failed to initialise map");throw h}},zoomToMaxExtent:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);d.zoomToMaxExtent(f)},zoomTo:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.zoomTo(f,g)},currentZoomLevel:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.currentZoomLevel(f)},addLayer:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);return d.addLayer(f,g)},registerMapMouseMove:function(f,h,e){var g=e||"olv2";var d=b.getImplementation(g);d.registerMapMouseMove(f,h)},registerMapMouseMoveEnd:function(f,h,e){var g=e||"olv2";var d=b.getImplementation(g);d.registerMapMouseMoveEnd(f,h)},registerMapClick:function(f,h,e){var g=e||"olv2";var d=b.getImplementation(g);d.registerMapClick(f,h)},unRegisterMapClick:function(f,h,e){var g=e||"olv2";var d=b.getImplementation(g);d.unRegisterMapClick(f,h)},registerMapEvent:function(g,f,i,e){var h=e||"olv2",d=b.getImplementation(h);d.registerMapEvent(g,f,i,e)},unRegisterMapEvent:function(g,f,i,e){var h=e||"olv2",d=b.getImplementation(h);d.unRegisterMapEvent(g,f,i,e)},getCurrentMapExtent:function(f,e){var g=e||"olv2",d=b.getImplementation(g);return d.getCurrentMapExtent(f)},addControl:function(d,g,j,f,l,e,i){var k=i||"olv2";var h=b.getImplementation(k);return h.addControl(d,g,j,f,l,e)},isControlActive:function(f,g,h,e){var i=e||"olv2";var d=b.getImplementation(i);return d.isControlActive(f,g,h)},activateControl:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.activateControl(f,g)},deactivateControl:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.deactivateControl(f,g)},registerControlEvent:function(g,h,f,j,e){var i=e||"olv2";var d=b.getImplementation(i);d.registerControlEvent(g,h,f,j)},unRegisterControlEvent:function(g,h,f,j,e){var i=e||"olv2";var d=b.getImplementation(i);d.unRegisterControlEvent(g,h,f,j)},getLayers:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.getLayers(f)},getLayersByName:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);return d.getLayersByName(f,g)},zoomToLayer:function(g,f,e){var h=e||"olv2";var d=b.getImplementation(h);d.zoomToLayer(g,f)},setLayerVisibility:function(h,g,f,e){var i=e||"olv2";var d=b.getImplementation(i);d.setLayerVisibility(h,g,f)},createBoundingBox:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);return d.createBoundingBox(f,g)},createBounds:function(g,h,e,f){var i=f||"olv2";var d=b.getImplementation(i);return d.createBounds(g,h,e)},zoomToExtent:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.zoomToExtent(f,g)},setCenter:function(g,h,i,e,f){var j=f||"olv2";var d=b.getImplementation(j);d.setCenter(g,h,i,e)},setInitialPositionAndZoom:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.setInitialPositionAndZoom(f,g,new a())},setBaseLayer:function(g,f,e){var h=e||"olv2";var d=b.getImplementation(h);d.setBaseLayer(g,f)},isBaseLayer:function(g,f,e){var h=e||"olv2";var d=b.getImplementation(h);return d.isBaseLayer(g,f)},setOpacity:function(g,f,h,e){var i=e||"olv2";var d=b.getImplementation(i);d.setOpacity(g,f,h)},mapResized:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);d.mapResized(f)},setMapMarker:function(f,i,j,h,g,e){var k=e||"olv2";var d=b.getImplementation(k);return d.setMapMarker(f,i,j,h,g)},removeMapMarker:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);d.removeMapMarker(f,g)},getLonLatFromPixel:function(h,f,j,e,g){var i=g||"olv2";var d=b.getImplementation(i);return d.getLonLatFromPixel(h,f,j,e)},getPixelFromLonLat:function(f,h,g,e){var i=e||"olv2";var d=b.getImplementation(i);return d.getPixelFromLonLat(f,h,g)},getPointFromEvent:function(g,f){var h=f||"olv2";var d=b.getImplementation(h);return d.getPointFromEvent(g)},drawPolyLine:function(f,h,g,e){var i=e||"olv2";var d=b.getImplementation(i);return d.drawPolyLine(f,h,g)},startRemoveSelectedFeature:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);return d.startRemoveSelectedFeature(f,g)},stopRemoveSelectedFeature:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.stopRemoveSelectedFeature(f)},removeFeature:function(f,g,h,e){var i=e||"olv2";var d=b.getImplementation(i);return d.removeFeature(f,g,h)},drawFeature:function(f,g,e){var h=e||"olv2";var d=b.getImplementation(h);return d.drawFeature(f,g)},startDrawingOnLayer:function(f,h,g,e){var i=e||"olv2";var d=b.getImplementation(i);return d.startDrawingOnLayer(f,h,g)},stopDrawing:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.stopDrawing(f)},drawLabel:function(f,h,g,e){var i=e||"olv2";var d=b.getImplementation(i);return d.drawLabel(f,h,g)},drawLabelWithPoint:function(f,h,g,e){var i=e||"olv2";var d=b.getImplementation(i);return d.drawLabelWithPoint(f,h,g)},createWfsClient:function(d,k,h,i,e,g,f,l){var m=l||"olv2";var j=b.getImplementation(m);return j.createWfsClient(d,k,h,i,e,g,f)},getFeatureInfo:function(e,n,d,i,g,f,l,k,j){var m=j||"olv2";var h=b.getImplementation(m);return h.getFeatureInfo(e,n,d,i,g,f,l,k)},getFeatureInfoFromLayer:function(i,k,g,e,h,f){var j=f||"olv2";var d=b.getImplementation(j);return d.getFeatureInfoFromLayer(i,k,g,e,h)},getMeasureFromEvent:function(g,h,f){var i=f||"olv2";var d=b.getImplementation(i);return d.getMeasureFromEvent(g,h)},addWfsClient:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.addWfsClient(f)},is3dSupported:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.is3dSupported(f)},is3d:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.is3d(f)},switchTo3dView:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.switchTo3dView(f)},switchTo2dView:function(f,e){var g=e||"olv2";var d=b.getImplementation(g);return d.switchTo2dView(f)},searchWfs:function(g,e,i,h,f){var j=f||"olv2";var d=b.getImplementation(j);return d.searchWfs(g,e,i,h)}}}]);app.service("mapServiceLocator",["$injector",function(b){var a={olv2:"olv2MapService",olv3:"olv3MapService"};return{getImplementation:function(c){return b.get(a[c])}}}]);(function(){var a=angular.module("gawebtoolkit.core.marker-directives",["gawebtoolkit.core.map-directives","gawebtoolkit.core.map-services","gawebtoolkit.core.layer-services"]);a.directive("gaMapMarker",["$log","$timeout","GALayerService",function(d,c,b){return{restrict:"E",require:"^gaMap",scope:{markerIcon:"@",markerLong:"@",markerLat:"@",markerId:"@",markerWidth:"@",markerHeight:"@",mapMarkerClicked:"&",layerName:"@"},link:function(f,h,g,i){f.framework=i.getFrameworkVersion();g.$observe("markerIcon",function(j){});g.$observe("markerLong",function(j){});g.$observe("markerLat",function(j){});g.$observe("markerId",function(j){});g.$observe("markerWidth",function(j){});g.$observe("markerHeight",function(j){});function e(){var n,o,l,j,m;m=f.markerIcon;if(typeof f.markerLong==="string"){o=parseFloat(f.markerLong)}if(typeof f.markerLat==="string"){n=parseFloat(f.markerLat)}if(typeof f.markerWidth==="string"){l=parseInt(f.markerWidth)}if(typeof f.markerHeight==="string"){j=parseInt(f.markerHeight)}var k=b.createLayer({layerType:"markerlayer",layerName:f.layerName},f.framework);i.addMarkerLayer(k,f.layerName).then(function(){var p=i.getPixelFromLonLat(o,n);f.markerDto=i.setMapMarker(p,f.layerName,m,{width:l,height:j})})}e();f.$on("$destroy",function(){i.removeMapMarker(f.markerDto.id)})}}}])})();var angular=angular||{};var console=console||{};var $=$||{};var app=angular.module("gawebtoolkit.utils",[]);app.service("GAWTUtils",[function(){return{generateUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})},convertHexToRgb:function(d){function b(f){return parseInt((c(f)).substring(0,2),16)}function a(f){return parseInt((c(f)).substring(2,4),16)}function e(f){return parseInt((c(f)).substring(4,6),16)}function c(f){return(f.charAt(0)==="#")?f.substring(1,7):f}return[b(d),a(d),e(d)]},convertHexAndOpacityToRgbArray:function(e,c){function b(g){return parseInt((d(g)).substring(0,2),16)}function a(g){return parseInt((d(g)).substring(2,4),16)}function f(g){return parseInt((d(g)).substring(4,6),16)}function d(g){return(g.charAt(0)==="#")?g.substring(1,7):g}return[b(e),a(e),f(e),c]}}}]);(function(){var b=angular.module("gawebtoolkit.mapservices.data.openlayersv2",[]);var a=["$q","$http",function(d,f){function c(j,l,r,m){var q=j.projection;var h=j.getExtent();var w=h.toBBOX();var u=(event instanceof MouseEvent)?l.xy:l;var t=j.getSize().h/2;var o=j.getSize().w/2;var s=new OpenLayers.Geometry.Point(o,t);var k=j.getSize().w;var n=j.getSize().h;var g={x:u.x,y:u.y};var i;if(j.getSize().w>=2050){if(u.x>s.x){if(u.y>s.y){var v=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(s.x,s.y));var p=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(j.getSize().w,j.getSize().h));i=new OpenLayers.Bounds(v.lon,p.lat,p.lon,v.lat);g.x=u.x-o;g.y=u.y-t}else{var v=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(s.x,0));var p=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(j.getSize().w,j.getSize().h));i=new OpenLayers.Bounds(v.lon,p.lat,p.lon,v.lat);g.x=u.x-o}}else{if(u.y>s.y){var v=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(0,s.y));var p=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(s.x,j.getSize().h));i=new OpenLayers.Bounds(v.lon,p.lat,p.lon,v.lat);g.y=u.y-t}else{var v=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(0,0));var p=j.getLonLatFromPixel(new OpenLayers.Geometry.Point(s.x,s.y));i=new OpenLayers.Bounds(v.lon,p.lat,p.lon,v.lat)}}w=i.toBBOX();n=Math.floor(t);k=Math.floor(o)}return OpenLayers.Util.extend({service:"WMS",version:r,request:"GetFeatureInfo",bbox:w,feature_count:100,height:n,width:k,format:OpenLayers.Format.WMSGetFeatureInfo,info_format:m},(parseFloat(r)>=1.3)?{crs:q,i:parseInt(g.x),j:parseInt(g.y)}:{srs:q,x:parseInt(g.x),y:parseInt(g.y)})}function e(i){var g;var h;if(i&&typeof i==="string"&&i.indexOf("application/vnd.ogc.gml/3")===0){h="application/vnd.ogc.gml/3"}else{h=i}switch(h){case"application/vnd.ogc.gml":g=OpenLayers.Format.GML.v2;break;case"application/vnd.ogc.gml/3":g=OpenLayers.Format.GML.v3;break;case"text/html":case"text/plain":g=OpenLayers.Format.Text;break;case"application/json":g=OpenLayers.Format.GeoJSON;break;default:g=OpenLayers.Format.WMSGetFeatureInfo;break}return g}return{getLayersByWMSCapabilities:function(h){var g=d.defer();f.get(h+"?request=GetCapabilities").success(function(l,i,n,j){var m=new OpenLayers.Format.WMSCapabilities();var k=m.read(l).capability.layers;g.resolve(k)});return g.promise},getWMSFeatures:function(h,g,m,l,i,o){var j=o||"text/xml";var p=d.defer();var k=c(h,i,l,j);if(m.length!==0){k=OpenLayers.Util.extend({layers:m,query_layers:m},k)}OpenLayers.Util.applyDefaults(k,{});var n={url:g,params:OpenLayers.Util.upperCaseObject(k),callback:function(s){var t=new (e(j))();var r=t.read(s.responseText);var u=new OpenLayers.Format.GeoJSON();var q=angular.fromJson(u.write(r));p.resolve(q)},scope:this};OpenLayers.Request.GET(n);return p.promise},getWMSFeaturesByLayerId:function(k,h,m,u){var j=function(x){var i;if(x.params.STYLES){i=x.params.STYLES}else{if(OpenLayers.Util.isArray(x.params.LAYERS)){i=new Array(x.params.LAYERS.length)}else{i=x.params.LAYERS.toString().replace(/[^,]/g,"")}}return i};var w=d.defer();var r=[],v=[];var o=[k.getLayersBy("id",m)[0]];for(var n=0,q=o.length;n<q;n++){if(o[n].params.LAYERS!=null){r=r.concat(o[n].params.LAYERS);v=v.concat(j(o[n]))}}var g=o[0];var p=k.getProjection();var s=g.projection;if(s&&s.equals(k.getProjectionObject())){p=s.getCode()}var l=OpenLayers.Util.extend({service:"WMS",version:g.params.VERSION,request:"GetFeatureInfo",exceptions:g.params.EXCEPTIONS,bbox:k.getExtent().toBBOX(null,g.reverseAxisOrder()),feature_count:100,height:k.getSize().h,width:k.getSize().w,format:OpenLayers.Format.WMSGetFeatureInfo,info_format:g.params.INFO_FORMAT||"text/xml"},(parseFloat(g.params.VERSION)>=1.3)?{crs:p,i:parseInt(u.x),j:parseInt(u.y)}:{srs:p,x:parseInt(u.x),y:parseInt(u.y)});if(r.length!==0){l=OpenLayers.Util.extend({layers:r,query_layers:r,styles:v},l)}OpenLayers.Util.applyDefaults(l,{});var t={url:h,params:OpenLayers.Util.upperCaseObject(l),callback:function(y){var z=new OpenLayers.Format.WMSGetFeatureInfo();var x=z.read(y.responseText);var A=new OpenLayers.Format.GeoJSON();var i=angular.fromJson(A.write(x));w.resolve(i)},scope:this};OpenLayers.Request.GET(t);return w.promise}}}];b.service("WMSDataService",a);b.service("olv2DataService",a)})();(function(){var b=angular.module("gawebtoolkit.mapservices.data.openlayersv3",[]);var a=["$q","$http",function(d,f){function c(o,j,i,n){var y=o.getView().getProjection().getCode();var k=o.getView().calculateExtent(o.getSize());var w=new OpenLayers.Bounds(k[0],k[1],k[2],k[3]);var g=w.toBBOX();var u=(j instanceof ol.MapBrowserPointerEvent)?j.pixel:j;var r=o.getSize()[1]/2;var l=o.getSize()[0]/2;var v=[l,r];var h=o.getSize()[0];var t=o.getSize()[1];var q={x:u[0],y:u[1]};var p;if(o.getSize()[0]>=2050){if(u[0]>v[0]){if(u[1]>v[1]){var s=o.getCoordinateFromPixel([v[0],v[1]]);var m=o.getCoordinateFromPixel([o.getSize()[0],o.getSize()[1]]);p=new OpenLayers.Bounds(s[0],m[1],m[0],s[1]);q.x=u[0]-l;q.y=u[1]-r}else{var s=o.getCoordinateFromPixel([v[0],0]);var m=o.getCoordinateFromPixel([o.getSize()[0],o.getSize()[1]]);p=new OpenLayers.Bounds(s[0],m[1],m[0],s[1]);q.x=u[0]-l}}else{if(u[1]>v[1]){var s=o.getCoordinateFromPixel([0,v[1]]);var m=o.getCoordinateFromPixel([v[0],o.getSize()[1]]);p=new OpenLayers.Bounds(s[0],m[1],m[0],s[1]);q.y=u[1]-r}else{var s=o.getCoordinateFromPixel([0,0]);var m=o.getCoordinateFromPixel([v[0],v[1]]);p=new OpenLayers.Bounds(s[0],m[1],m[0],s[1])}}g=p.toBBOX();t=Math.floor(r);h=Math.floor(l)}var x=OpenLayers.Util.extend({service:"WMS",version:i,request:"GetFeatureInfo",bbox:g,feature_count:100,height:t,width:h,format:OpenLayers.Format.WMSGetFeatureInfo,info_format:n},(parseFloat(i)>=1.3)?{crs:y,i:parseInt(q.x),j:parseInt(q.y)}:{srs:y,x:parseInt(q.x),y:parseInt(q.y)});return x}function e(i){var g;var h;if(i&&typeof i==="string"&&i.indexOf("application/vnd.ogc.gml/3")===0){h="application/vnd.ogc.gml/3"}else{h=i}switch(h){case"application/vnd.ogc.gml":g=OpenLayers.Format.GML.v2;break;case"application/vnd.ogc.gml/3":g=OpenLayers.Format.GML.v3;break;case"text/html":case"text/plain":g=OpenLayers.Format.Text;break;case"application/json":g=OpenLayers.Format.GeoJSON;break;default:g=OpenLayers.Format.WMSGetFeatureInfo;break}return g}return{getLayersByWMSCapabilities:function(h){var g=d.defer();f.get(h+"?request=GetCapabilities").success(function(l,i,n,j){var m=new OpenLayers.Format.WMSCapabilities();var k=m.read(l).capability.layers;g.resolve(k)});return g.promise},getWMSFeatures:function(h,g,m,l,i,o){var j=o||"text/xml";var p=d.defer();var k=c(h,i,l,j);if(m.length!==0){k=OpenLayers.Util.extend({layers:m,query_layers:m},k)}OpenLayers.Util.applyDefaults(k,{});var n={url:g,params:OpenLayers.Util.upperCaseObject(k),callback:function(s){var t=new (e(j))();var r=t.read(s.responseText);var u=new OpenLayers.Format.GeoJSON();var q=angular.fromJson(u.write(r));p.resolve(q)},scope:this};OpenLayers.Request.GET(n);return p.promise},getWMSFeaturesByLayerId:function(k,h,m,t){var j=function(w){var i;if(w.getParams().STYLES){i=w.getParams().STYLES}else{if(OpenLayers.Util.isArray(w.getParams().LAYERS)){i=new Array(w.getParams().LAYERS.length)}else{i=w.getParams().LAYERS.toString().replace(/[^,]/g,"")}}return i};var v=d.defer();var r=[],u=[];var o=[k.getLayersBy("id",m)[0]];for(var n=0,q=o.length;n<q;n++){if(o[n].getParams().LAYERS!=null){r=r.concat(o[n].getParams().LAYERS);u=u.concat(j(o[n]))}}var g=o[0];var p=k.getView().getProjection().getCode();var l=OpenLayers.Util.extend({service:"WMS",version:g.getParams().VERSION,request:"GetFeatureInfo",bbox:k.getExtent().toBBOX(null),feature_count:100,height:k.getSize()[1],width:k.getSize()[0],format:OpenLayers.Format.WMSGetFeatureInfo,info_format:g.params.INFO_FORMAT||"text/xml"},(parseFloat(g.params.VERSION)>=1.3)?{crs:p,i:parseInt(t.x),j:parseInt(t.y)}:{srs:p,x:parseInt(t.x),y:parseInt(t.y)});if(r.length!==0){l=OpenLayers.Util.extend({layers:r,query_layers:r,styles:u},l)}OpenLayers.Util.applyDefaults(l,{});var s={url:h,params:OpenLayers.Util.upperCaseObject(l),callback:function(x){var y=new OpenLayers.Format.WMSGetFeatureInfo();var w=y.read(x.responseText);var z=new OpenLayers.Format.GeoJSON();var i=angular.fromJson(z.write(w));v.resolve(i)},scope:this};OpenLayers.Request.GET(s);return v.promise}}}];b.service("olv3DataService",a)})();var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var google=google||{};var app=angular.module("gawebtoolkit.mapservices.layer.openlayersv2",[]);app.service("olv2LayerService",["$log","$q","$timeout",function(d,b,c){var a={xyzTileCachePath:"/tile/${z}/${y}/${x}",createLayer:function(e){var f;switch(e.layerType.toLowerCase()){case"wms":f=a.createWMSLayer(e);break;case"xyztilecache":f=a.createXYZLayer(e);break;case"arcgiscache":f=a.createArcGISCacheLayer(e);break;case"vector":f=a.createFeatureLayer(e);break;case"googlestreet":case"googlehybrid":case"googlesatellite":case"googleterrain":f=a.createGoogleMapsLayer(e);break;case"markerlayer":f=a.createMarkerLayer(e);break;default:throw new Error("Invalid layerType used to create layer of name "+e.layerName+" - with layerType - "+e.layerType)}f.geoLayerType=e.layerType;return f},createGoogleLayer:function(f){if(f.layerType==null){throw new Error("'layerType' not specified for creating a Google Maps layer. Please specify a valid layer type, eg 'hybrid")}var g;switch(f.layerType.toLocaleLowerCase()){case"hybrid":g=google.maps.MapTypeId.HYBRID;break;case"satellite":g=google.maps.MapTypeId.SATELLITE;break;case"street":g=google.maps.MapTypeId.STREET;break;case"terrain":g=google.maps.MapTypeId.TERRAIN;break;default:g=google.maps.MapTypeId.HYBRID;break}var e={visibility:f.visibility===true||f.visibility==="true",type:g};return new OpenLayers.Layer.Google(f.layerType,e)},createBingLayer:function(f){var h;var g=f.layerName;switch(f.layerType.toLocaleLowerCase()){case"aerial":h="Aerial";g=g||"Bing Aerial";break;case"aerialwithlabels":h="AerialWithLabels";g=g||"Bing Aerial With Labels";break;case"birdseye":h="Birdseye";g=g||"Bing Birdseye";break;case"birdseyewithlabels":h="BirdseyeWithLabels";g=g||"Bing Birdseye With Labels";break;case"road":h="Road";g=g||"Bing Roads";break;default:h="Road";g=g||"Bing Roads";break}var e=new OpenLayers.Layer.Bing({key:f.bingApiKey,type:h,name:g,visibility:f.visibility===true||f.visibility==="true"});e.wrapDateLine=f.wrapDateLine||false;return e},createOsmLayer:function(f){var e=new OpenLayers.Layer.OSM(f.layerName||"OpenCycleMap");e.wrapDateLine=f.wrapDateLine||false;e.visibility=f.visibility===true||f.visibility==="true";return e},createFeatureLayer:function(e){var f;if(e.url==null){f=new OpenLayers.Layer.Vector(e.layerName)}else{a.postAddLayerCache=a.postAddLayerCache||[];f=new OpenLayers.Layer.Vector(e.layerName,{strategies:[new OpenLayers.Strategy.Fixed()],styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:"10",fillOpacity:0.6,fillColor:"#ffcc66",strokeColor:"#cc6633"}),select:{fillColor:"#8aeeef"}}),protocol:new OpenLayers.Protocol.WFS({url:e.url,featureType:e.wfsFeatureType,featurePrefix:e.wfsFeaturePrefix,version:e.wfsVersion,geometryName:e.wfsGeometryName,srsName:e.datumProjection}),visibility:e.visibility})}if(e.postAddLayer!=null){a.postAddLayerCache[f.id]=e.postAddLayer}return f},createMarkerLayer:function(e){return new OpenLayers.Layer.Markers(e.layerName)},createGoogleMapsLayer:function(f){var g;switch(f.layerType){case"GoogleStreet":g=google.maps.MapTypeId.STREET;break;case"GoogleHybrid":g=google.maps.MapTypeId.HYBRID;break;case"GoogleSatellite":g=google.maps.MapTypeId.SATELLITE;break;case"GoogleTerrain":g=google.maps.MapTypeId.TERRAIN;break}var e={wrapDateLine:f.wrapDateLine,transitionEffect:f.transitionEffect,visibility:f.visibility===true||f.visibility==="true",isBaseLayer:f.isBaseLayer===true||f.isBaseLayer==="true",tileSize:f.tileSize(f.tileType),sphericalMercator:f.sphericalMercator,centerPosition:f.centerPosition,attribution:f.layerAttribution,numZoomLevels:20,type:g,animationEnabled:true};return new OpenLayers.Layer.Google(f.layerName,e)},clearFeatureLayer:function(f,e){},createXYZLayer:function(e){var f={layerName:e.layerName,layerUrl:e.layerUrl,options:{wrapDateLine:e.wrapDateLine,transitionEffect:e.transitionEffect,visibility:e.visibility===true||e.visibility==="true",isBaseLayer:e.isBaseLayer===true||e.isBaseLayer==="true",tileSize:e.tileSize(e.tileType),sphericalMercator:e.sphericalMercator,centerPosition:e.centerPosition,attribution:e.layerAttribution,opacity:e.opacity}};if(f.options.isBaseLayer){if(e.resolutions){f.options.resolutions=e.resolutions}if(e.zoomOffset){f.options.zoomOffset=e.zoomOffset}}if(e.maxZoomLevel!=null){if(e.maxZoomLevel.length>0){f.options.numZoomLevels=parseInt(e.maxZoomLevel)}}return new OpenLayers.Layer.XYZ(f.layerName,f.layerUrl+a.xyzTileCachePath,f.options)},createWMSLayer:function(e){var f={layerName:e.layerName,layerUrl:e.layerUrl,layers:e.layers,wrapDateLine:e.wrapDateLine,visibility:e.visibility===true||e.visibility==="true",isBaseLayer:e.isBaseLayer===true||e.isBaseLayer==="true",transitionEffect:e.transitionEffect,tileSize:e.tileSize(e.tileType),sphericalMercator:e.sphericalMercator,tileType:e.tileType,projection:e.datumProjection,transparent:e.transparent,attribution:e.layerAttribution,opacity:e.opacity};if(e.maxZoomLevel!=null){if(e.maxZoomLevel.length>0){f.numZoomLevels=parseInt(e.maxZoomLevel)}}return new OpenLayers.Layer.WMS(f.layerName,f.layerUrl,{layers:f.layers,format:f.format,transparent:f.transparent},f)},createArcGISCacheLayer:function(g){var f=b.defer();var h=new OpenLayers.Protocol.Script();var e=c(function(){f.reject("LayerTimeout")},10000);h.createRequest(g.layerUrl,{f:"json",pretty:"true"},function(j){c.cancel(e);if(j.error!=null&&j.error.code!=null){f.reject("LayerError - "+j.error.code);return}var k={layerName:g.layerName,layerUrl:g.layerUrl,options:{transitionEffect:g.transitionEffect,visibility:g.visibility===true||g.visibility==="true",isBaseLayer:g.isBaseLayer===true||g.isBaseLayer==="true",tileSize:g.tileSize(),alwaysInRange:false,displayInLayerSwitcher:false,opacity:g.opacity,attribution:g.layerAttribution}};if(g.maxZoomLevel!=null){if(g.maxZoomLevel.length>0){k.options.numZoomLevels=parseInt(g.maxZoomLevel)}}if(j){k.options.layerInfo=j;if(k.options.numZoomLevels==null){k.options.numZoomLevels=j.tileInfo.lods.length+1}}var i=new OpenLayers.Layer.ArcGISCache(k.layerName,k.layerUrl,k.options);f.resolve(i)});return f.promise},defaultLayerOptions:function(f,e){var g=angular.extend(e.defaultOptions,f);g.centerPosition=a.parselatLong(g.centerPosition);return g},cleanupLayer:function(f,e){if(f.layers==null||f.layers.length===0){return}var g=a.getLayerById(f,e);if(g!=null){f.removeLayer(g)}},createFeature:function(g,f){var e;if(g.projection!==f.crs.properties.name){e=new OpenLayers.Format.GeoJSON({externalProjection:f.crs.properties.name,internalProjection:g.projection})}else{e=new OpenLayers.Format.GeoJSON()}return e.read(angular.toJson(f),f.type)},addFeatureToLayer:function(g,f,i){var h=a.getLayerById(g,f);if(i instanceof Array){h.addFeatures(i)}else{h.addFeatures([i])}var j=new OpenLayers.Format.GeoJSON();var e=angular.fromJson(j.write(i));e.id=i.id;return e},parselatLong:function(e){if(!e){return null}return angular.fromJson(e)},getLayerById:function(g,e){var f;for(var h=0;h<g.layers.length;h++){if(g.layers[h].id===e){f=g.layers[h];break}}return f},removeLayerByName:function(e,f){var g=e.getLayersByName(f);if(g.length>0){e.removeLayer(g[0])}},removeLayersByName:function(e,f){var h=e.getLayersByName(f);for(var g=0;g<h.length;g++){e.removeLayer(h[g])}},removeLayer:function(e,f){e.removeLayer(f)},removeLayerById:function(f,e){var g=f.getLayersBy("id",e)[0];f.removeLayer(g)},removeFeatureFromLayer:function(f,e,i){var h=f.getLayersBy("id",e)[0];var g=h.getFeatureById(i);h.removeFeatures(g)},registerFeatureSelected:function(f,e,l,i){var h=f.getLayersBy("id",e)[0];var j=h.geoLayerType;var g;if(j==="WMS"){g=OpenLayers.Protocol.WFS.fromWMSLayer(h)}var k=f.getControl("ctrlGetFeature");if(k){f.removeControl(k)}k=new OpenLayers.Control.GetFeature({protocol:g,box:true,hover:true,multipleKey:"shiftKey",toggleKey:"ctrlKey"});k.metadata=k.metadata||{};k.metadata.type="getfeature";k.events.register("featureselected",i,l);return{id:"ctrlGetFeature",name:"getfeature"}},registerLayerEvent:function(g,e,f,i){var h=g.getLayersBy("id",e)[0];h.events.register(f,h,i)},unRegisterLayerEvent:function(g,e,f,i){var h=g.getLayersBy("id",e)[0];h.events.unregister(f,h,i)},getMarkerCountForLayerName:function(e,f){var h=e.getLayersByName(f);var g=0;if(h.length>0){g=h[0].markers==null?0:h[0].markers.length}return g},filterFeatureLayer:function(f,g,m,n){var l=a.getLayerById(f,g);var k=a.parseFeatureAttributes(n);var h=[];for(var j=0;j<k.length;j++){h.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:k[j],matchCase:false,value:m.toUpperCase()+"*"}))}var e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:h});if(e.filters.length===1){l.filter=h[0];l.refresh({force:true})}else{l.filter=e;l.refresh({force:true})}},parseFeatureAttributes:function(e){if(!e){return null}var f=[];if(e.indexOf(",")===-1){f.push(e)}else{f=e.split(",")}return f},getLayerFeatures:function(f,e){var j=[];var h=a.getLayerById(f,e);for(var g=0;g<h.features.length;g++){j.push(h.features[g])}return j},raiseLayerDrawOrder:function(f,e,h){var g=a.getLayerById(f,e);f.raiseLayer(g,h)},postAddLayerCache:{}};return a}]);(function(){var a=angular.module("gawebtoolkit.mapservices.layer.openlayersv3",[]);a.service("olv3LayerService",["$log","$q","$timeout","GeoLayer","GAWTUtils",function(f,c,d,e,g){var b={xyzTileCachePath:"/tile/{z}/{y}/{x}",createLayer:function(h){var i;switch(h.layerType){case"WMS":i=b.createWMSLayer(h);break;case"XYZTileCache":i=b.createXYZLayer(h);break;case"ArcGISCache":i=b.createArcGISCacheLayer(h);break;case"Vector":i=b.createFeatureLayer(h);break;case"markerlayer":i=b.createMarkerLayer(h);break;case"GoogleStreet":case"GoogleHybrid":case"GoogleSatellite":case"GoogleTerrain":throw new Error("Google map layers are not supported with OpenLayers 3. To use a Google maps layer, consider falling back to framework 'olv2'.");default:throw new Error("Invalid layerType used to create layer of name "+h.layerName+" - with layerType - "+h.layerType)}i.geoLayerType=h.layerType;if(h.maxZoomLevel){i.geoMaxZoom=parseInt(h.maxZoomLevel)}if(h.minZoomLevel){i.geoMinZoom=parseInt(h.minZoomLevel)}return i},createFeatureLayer:function(h){var i;if(h.url==null){i=new ol.layer.Vector({source:new ol.source.Vector(),format:new ol.format.GeoJSON()})}else{b.postAddLayerCache=b.postAddLayerCache||[];var j=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.6)"}),stroke:new ol.style.Stroke({color:"#319FD3",width:1}),text:new ol.style.Text({font:"12px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})});i=new ol.layer.Vector({source:new ol.source.Vector({url:h.url,format:new ol.format.GeoJSON(),style:j})})}i.set("name",h.layerName);i.set("isBaseLayer",h.isBaseLayer||false);return i},createMarkerLayer:function(i){var h=new ol.layer.Vector({source:new ol.source.Vector(),format:new ol.format.GeoJSON()});h.set("name",i.layerName);return h},createGoogleLayer:function(h){throw new Error("Google map layers are not supported with OpenLayers 3. To use a Google maps layer, consider falling back to framework 'olv2'.")},createBingLayer:function(h){var k;var j=h.layerName;switch(h.layerType.toLocaleLowerCase()){case"aerial":k="Aerial";j=j||"Bing Aerial";break;case"aerialwithlabels":k="AerialWithLabels";j=j||"Bing Aerial With Labels";break;case"birdseye":k="Birdseye";j=j||"Bing Birdseye";break;case"birdseyewithlabels":k="BirdseyeWithLabels";j=j||"Bing Birdseye With Labels";break;case"road":k="Road";j=j||"Bing Roads";break;default:k="Road";break}var i=new ol.layer.Tile({source:new ol.source.BingMaps({key:h.bingApiKey,imagerySet:k})});i.set("name",j);i.setVisible(h.visibility===true||h.visibility==="true");return i},createOsmLayer:function(h){var i=new ol.layer.Tile({source:new ol.source.OSM()});i.setVisible(h.visibility===true||h.visibility==="true");return i},clearFeatureLayer:function(i,h){},createXYZLayer:function(j){var i={url:j.layerUrl+b.xyzTileCachePath,crossOrigin:"*/*"};if(j.layerAttribution!=null){i.attributions=[new ol.Attribution({html:j.layerAttribution})]}var k={opacity:j.opacity,source:new ol.source.XYZ(i),visible:j.visibility===true||j.visibility==="true"};var h=new ol.layer.Tile(k);h.set("name",j.layerName);h.set("isBaseLayer",j.isBaseLayer||false);return h},createWMSLayer:function(j){var i={};i.url=j.layerUrl;i.crossOrigin="anonymous";i.params={LAYERS:j.layers,TILED:true};if(j.format){i.params.FORMAT=j.format}i.wrapX=true;if(j.wrapDateLine!=null){i.wrapX=j.wrapDateLine==="true"||j.wrapDateLine===true}i.serverType=("mapserver");if(j.layerAttribution!=null){i.attributions=[new ol.Attribution({html:j.layerAttribution})]}var l=new ol.source.TileWMS(i);var k={};k.source=l;k.visible=j.visibility==="true"||j.visibility===true;k.opacity=j.opacity;var h=new ol.layer.Tile(k);h.set("name",j.layerName);h.set("isBaseLayer",j.isBaseLayer||false);return h},createArcGISCacheLayer:function(j){var i={url:j.layerUrl+b.xyzTileCachePath,crossOrigin:"*/*"};var k={opacity:j.opacity,source:new ol.source.XYZ(i),visible:j.visibility===true||j.visibility==="true"};var h=new ol.layer.Tile(k);h.set("name",j.layerName);h.set("isBaseLayer",j.isBaseLayer||false);return h},defaultLayerOptions:function(i,h){var j=angular.extend(h.defaultOptions,i);j.centerPosition=b.parselatLong(j.centerPosition);return j},cleanupLayer:function(i,h){var j=b.getLayerBy(i,"id",h);if(j!=null){i.removeLayer(j)}},createFeature:function(j,i){var h;if(j.getView().getProjection()!==i.crs.properties.name){h=new ol.format.GeoJSON({defaultDataProjection:i.crs.properties.name})}else{h=new new ol.format.GeoJSON({defaultDataProjection:j.getView().getProjection()})}return h.readFeature(angular.toJson(i),{dataProjection:i.crs.properties.name,featureProjection:j.getView().getProjection()})},addFeatureToLayer:function(j,i,m){var l=b.getLayerById(j,i);var o=l.getSource();if(typeof o.getFeatures!=="function"){throw new Error("Layer does not have a valid source for features.")}var n=new ol.format.GeoJSON();var k;if(m instanceof Array){o.addFeatures(m);k=n.writeFeatures(m)}else{o.addFeature(m);k=n.writeFeature(m)}var h=angular.fromJson(k);m.id=m.getId()||g.generateUuid();h.id=m.id;return h},parselatLong:function(h){if(!h){return null}return angular.fromJson(h)},getLayerById:function(i,h){return b.getLayerBy(i,"id",h)},getLayerBy:function(j,i,h){var k=null;var l=false;j.getLayers().forEach(function(m){if(h===m.get(i)&&l===false){k=m;l=true}});return k},getLayerByName:function(h,i){return b.getLayerBy(h,"name",i)},getLayersBy:function(j,i,h){var l=j.getLayers();var k=[];l.forEach(function(n){var m=n.get(i);if(m&&m.indexOf(h)!==-1){k.push(e.fromOpenLayersV3Layer(n))}});return k},_getLayersBy:function(j,i,h){var l=j.getLayers();var k=[];l.forEach(function(n){var m=n.get(i);if(m&&m.indexOf(h)!==-1){k.push(n)}});return k},removeLayerByName:function(h,i){var j=b._getLayersBy(h,"name",i);if(j.length>0){h.removeLayer(j[0])}},removeLayersByName:function(h,j){var l=b._getLayersBy(h,"name",j);for(var k=0;k<l.length;k++){h.removeLayer(l[k])}},removeLayer:function(h,i){h.removeLayer(i)},removeLayerById:function(i,h){var j=b._getLayersBy(i,"id",h)[0];i.removeLayer(j)},removeFeatureFromLayer:function(j,h,o){var m=b.getLayerById(j,h);var n=m.getSource().getFeatures();for(var l=0;l<n.length;l++){var k=n[l];if(k.id===o){m.getSource().removeFeature(k);break}}},registerFeatureSelected:function(k,j,o,n){b.registeredInteractions=b.registeredInteractions||[];for(var m=0;m<b.registeredInteractions.length;m++){var h=b.registeredInteractions[m];if(h.id===""+j+"_features"){k.removeInteraction(h.select)}}var l=new ol.interaction.Select({condition:ol.events.condition.click});l.on("select",function(i){if(i.target.get("id")===j){o(i)}});b.registeredInteractions.push({id:j+"_features",select:l});k.addInteraction(l)},registerLayerEvent:function(j,h,i,l){var k=b.getLayerBy(j,"id",h);k.getSource().on(i,l)},unRegisterLayerEvent:function(j,h,i,l){var k=b.getLayerBy(j,"id",h);k.getSource().un(i,l)},getMarkerCountForLayerName:function(h,i){var j=b.getLayerBy(h,"name",i);return j==null?0:typeof j.getSource().getFeatures==="undefined"?0:j.getSource().getFeatures().length},filterFeatureLayer:function(i,h,j){throw new Error("NotImplementedError")},parseFeatureAttributes:function(h){if(!h){return null}var i=[];if(h.indexOf(",")===-1){i.push(h)}else{i=h.split(",")}return i},getLayerFeatures:function(j,h){var m=[];var l=b.getLayerById(j,h);var o=l.getSource();if(o.getFeatures==null){return m}var p=o.getFeatures();for(var k=0;k<p.length;k++){var n=p[k];m.push(n)}return m},raiseLayerDrawOrder:function(j,k,r){var m=b.getLayerById(j,k);var p=j.getLayers();var o;for(var l=0;l<p.getLength();l++){var n=p.item(l);if(n.get("id")===k){o=l;break}}var h=o+r;var q=j.getLayers().getArray()[h];j.getLayers().getArray()[h]=m;j.getLayers().getArray()[o]=q;j.updateSize()},postAddLayerCache:{}};return b}])})();var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var darwin=darwin||{};var app=angular.module("gawebtoolkit.mapservices.controls.openlayersv2",[]);app.service("olv2MapControls",[function(){var b=[{name:"permalink",constructor:OpenLayers.Control.Permalink},{name:"overviewmap",constructor:OpenLayers.Control.OverviewMap},{name:"scale",constructor:OpenLayers.Control.Scale},{name:"scaleline",constructor:OpenLayers.Control.ScaleLine},{name:"panzoombar",constructor:OpenLayers.Control.PanZoomBar},{name:"zoomslider",constructor:OpenLayers.Control.PanZoomBar},{name:"zoom",constructor:OpenLayers.Control.Zoom},{name:"mouseposition",constructor:OpenLayers.Control.MousePosition},{name:"attribution",constructor:OpenLayers.Control.Attribution},{name:"measureline",constructor:OpenLayers.Control.Measure,customParams:[OpenLayers.Handler.Path]},{name:"measurepolygon",constructor:OpenLayers.Control.Measure,customParams:[OpenLayers.Handler.Polygon]},{name:"wmsgetfeatureinfo",constructor:OpenLayers.Control.WMSGetFeatureInfo}];var a={resolveSupportedControl:function(d){var f;for(var e=0;e<b.length;e++){var c=b[e];if(c.name===d){f=c;break}}return f},createControl:function(c,g,f){var e;if(f&&!g.div){g.div=f}var d=a.resolveSupportedControl(c);if(d==null||d.constructor==null){throw new Error("Error in map control construction. Unsupported control or missing source for control constructor.")}if(d.customParams){if(g){e=new d.constructor(d.customParams[0],g)}else{e=new d.constructor(d.customParams[0])}}else{if(g){e=new d.constructor(g)}else{e=new d.constructor()}}return e},registerControl:function(c,d){b.push({name:c,constructor:d})}};return a}]);(function(){var a=angular.module("gawebtoolkit.mapservices.controls.openlayersv3",[]);a.service("olv3MapControls",[function(){var c=[{name:"overviewmap",constructor:ol.control.OverviewMap},{name:"scaleline",constructor:ol.control.ScaleLine},{name:"zoomslider",constructor:ol.control.ZoomSlider},{name:"panzoombar",constructor:ol.control.ZoomSlider},{name:"zoom",constructor:ol.control.Zoom},{name:"mouseposition",constructor:ol.control.MousePosition,resolveCustomParams:d},{name:"attribution",constructor:ol.control.Attribution}];function d(i,h){var e={};var g=function(j){return(function(k){if(k[0]>180){k[0]=k[0]-360}if(k[0]<-180){k[0]=k[0]+360}if(k[1]>90){k[1]=k[1]-180}if(k[1]<-90){k[1]=k[1]+180}return ol.coordinate.toStringXY(k,j)})};var f=function(j){return(function(k){if(k[0]>180){k[0]=k[0]-360}if(k[0]<-180){k[0]=k[0]+360}if(k[1]>90){k[1]=k[1]-180}if(k[1]<-90){k[1]=k[1]+180}return j({lon:k[0],lat:k[1]})})};if(i.formatOutput!=null){e.coordinateFormat=f(i.formatOutput)}else{e.coordinateFormat=i.coordinateFormat==null?g(4):i.coordinateFormat(4)}e.projection=i.projection||h.displayProjection;return e}var b={resolveSupportedControl:function(f){var h;for(var g=0;g<c.length;g++){var e=c[g];if(e.name===f){h=e;break}}return h},createControl:function(f,l,e,h){var j;if(e&&!l.div){l.element=e}var m=b.resolveSupportedControl(f);if(m==null||m.constructor==null){var n="Error in map control construction for '"+f+"'. Unsupported control or missing source for control constructor.";n+="\r\nSupported controls names are: ";for(var k=0;k<c.length;k++){var g=c[k];n+="\r\n"+g.name}throw new Error(n)}if(m.resolveCustomParams){l=angular.extend(l,angular.copy(m.resolveCustomParams(l,h)));j=new m.constructor(l)}else{if(m.customParams){l=angular.extend(l,angular.copy(m.customParams[0]));j=new m.constructor(l)}else{if(l){j=new m.constructor(l)}else{j=new m.constructor()}}}return j},registerControl:function(e,f){c.push({name:e,constructor:f})}};return b}]);if(ol!=null&&ol.control!=null&&ol.control.ZoomSlider!=null){ol.control.ZoomSlider.prototype.getPositionForResolution_=function(c){try{var d=this.getMap().getView().getValueForResolutionFunction();return 1-d(c)}catch(b){}}}})();var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var app=angular.module("gawebtoolkit.mapservices.map.openlayersv2",["gawebtoolkit.mapservices.layer.openlayersv2","gawebtoolkit.mapservices.controls.openlayersv2"]);app.service("olv2MapService",["olv2LayerService","olv2MapControls","GAWTUtils","GeoLayer","$q","$log",function(e,i,h,b,f,j){function c(m,l,k){m._geowebtoolkit=m._geowebtoolkit||{};m._geowebtoolkit[l]=k}function a(m,l){var k=null;if(m._geowebtoolkit!=null){k=m._geowebtoolkit[l]}return k}var d={initialiseMap:function(l,m){var k={};if(l.displayProjection==null){l.displayProjection=m.defaultOptions.displayProjection}d.displayProjection=l.displayProjection;if(l.datumProjection==null){l.datumProjection=m.defaultOptions.projection}k.projection=l.datumProjection;k.numZoomLevels=m.defaultOptions.numZoomLevels;k.displayProjection=l.displayProjection;if((!l.isStaticMap)&&(k.controls===undefined||k.controls===null)){k.controls=[new OpenLayers.Control.Navigation()]}else{k.controls=[]}return new OpenLayers.Map(l.mapElementId,k)},getParameterByName:function(k){k=k.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var m=new RegExp("[\\?&]"+k+"=([^&#]*)"),l=m.exec(document.URL);return l==null?"":decodeURIComponent(l[1].replace(/\+/g," "))},zoomToMaxExtent:function(k){k.zoomToMaxExtent()},currentZoomLevel:function(k){return k.getZoom()},addLayer:function(k,l){if(l.then!=null&&typeof l.then==="function"){l.then(function(m){k.addLayer(m);d.postLayerAddAction(k,l);return b.fromOpenLayersV2Layer(l)})}else{if(l.geoLayerType!=null&&l.geoLayerType.indexOf("Google")!==-1){k.zoomDuration=0}k.addLayer(l);d.postLayerAddAction(k,l);return b.fromOpenLayersV2Layer(l)}},postLayerAddAction:function(k,l){j.info("post layer add fired");if(e.postAddLayerCache[l.id]){e.postAddLayerCache[l.id]({map:k,layer:l})}g(k,e)},registerMapMouseMove:function(k,l){k.events.register("mousemove",k,l)},registerMapClick:function(k,l){k.events.register("click",k,l)},unRegisterMapClick:function(k,l){k.events.unregister("click",k,l)},registerMapMouseMoveEnd:function(k,l){k.events.register("moveend",k,l)},registerMapEvent:function(l,k,m){l.events.register(k,l,m)},unRegisterMapEvent:function(l,k,m){l.events.unregister(k,l,m)},getCurrentMapExtent:function(l){var n=l.getExtent();if(n==null){return null}n=n.transform(l.projection,d.displayProjection);var k=[];var q=[n.left,n.top];var p=[n.right,n.top];var m=[n.left,n.bottom];var o=[n.right,n.bottom];k.push(q);k.push(p);k.push(m);k.push(o);return k},isControlActive:function(l,n,p){var o;for(var m=0;l.controls.length;m++){var k=l.controls[m];if(k.id===n){o=k;break}}return o.active===true},addControl:function(m,p,q,o,s,n){p=p.toLowerCase();var r={};var k;if(o){k=$("#"+o)[0]}if(p==="mouseposition"){q=q||{}}var l=i.createControl(p,q,k);l.id=s||l.id;m.addControl(l);r.id=l.id;return r},getControls:function(l){var k=[];var m=l.controls;for(var n=0;n<m.length;n++){var o=m[n];k.push({id:o.metadata.id||o.id,name:o.metadata.type})}return k},getControlById:function(l,o){var k;var m=l.controls;for(var n=0;n<m.length;n++){var p=m[n];if(p.id===o){k=p;break}}return k},activateControl:function(k,l){var m=d.getControlById(k,l);m.activate()},deactivateControl:function(k,l){var m=d.getControlById(k,l);m.deactivate()},registerControlEvent:function(l,m,k,o){var n=d.getControlById(l,m);n.events.register(k,undefined,o)},unRegisterControlEvent:function(l,m,k,o){var n=d.getControlById(l,m);n.events.unregister(k,undefined,o)},getLayers:function(k){var l=[];angular.forEach(k.layers,function(m){l.push(b.fromOpenLayersV2Layer(m))});return l},getLayersByName:function(l,m){if(typeof m!=="string"&&typeof m!=="number"){throw new TypeError("Expected number")}var p=l.getLayersBy("name",m);var o=[];for(var n=0;n<p.length;n++){var k=p[n];o.push(b.fromOpenLayersV2Layer(k))}return o},setLayerVisibility:function(n,l,k){if(typeof k==="object"){throw new TypeError("Expected boolean")}var m=n.getLayersBy("id",l)[0];m.setVisibility(k)},createBoundingBox:function(k,m){var n=new OpenLayers.Bounds();for(var l=0;l<m.length;l++){n.extend(new OpenLayers.LonLat(m[l][0],m[l][1]))}return n.toBBOX()},createBounds:function(l,o,k){var p=new OpenLayers.Bounds();for(var n=0;n<o.length;n++){var m=new OpenLayers.LonLat(o[n][0],o[n][1]);m=m.transform(k,l.projection);p.extend(m)}return p},zoomToExtent:function(k,l){var m=d.createBounds(k,l,d.displayProjection);k.zoomToExtent(m,false)},zoomToLayer:function(l,k){var m=l.getLayersBy("id",k)[0];if(m==null){throw new ReferenceError('Layer not found - id: "'+k+'".')}var n=m.getExtent();l.zoomToExtent(n)},zoomTo:function(k,l){if(typeof l==="object"){throw new TypeError("Expected number")}k.zoomTo(l)},setBaseLayer:function(l,k){var m=l.getLayersBy("id",k)[0];l.setBaseLayer(m,false)},setCenter:function(m,o,p,k){var n=new OpenLayers.LonLat(p,o);if(k==null){m.setCenter(n)}else{var l=n.transform(new OpenLayers.Projection(k),new OpenLayers.Projection(m.getProjection()));m.setCenter(l)}},setInitialPositionAndZoom:function(o,t){if(d.getParameterByName("zoom")!==""&&t.centerPosition!=null){var u=new OpenLayers.LonLat(d.getParameterByName("lon"),d.getParameterByName("lat")).transform();var s=new OpenLayers.Projection(d.displayProjection);var v=new OpenLayers.Projection(o.getProjection());var l=u.transform(s,v);o.setCenter(l,d.getParameterByName("zoom"))}else{if(t.initialExtent!=null){var k=d.createBounds(o,t.initialExtent,d.displayProjection);o.zoomToExtent(k,true)}else{if(t.centerPosition){var q=JSON.parse(t.centerPosition);var n=new OpenLayers.LonLat(q[0],q[1]);var p=new OpenLayers.Projection(d.displayProjection);var r=new OpenLayers.Projection(o.getProjection());var m=n.transform(p,r);o.setCenter(m,t.zoomLevel)}else{o.zoomToMaxExtent()}}}},isBaseLayer:function(o,l){var k=false;var n;var m=o.layers.length;for(var p=0;p<m;p++){if(o.layers[p].id===l){n=o.layers[p];break}}if(n){if(n.id.indexOf("ArcGISCache")!==-1){k=n.options.isBaseLayer}else{k=n.isBaseLayer}}else{k=false}return k},setOpacity:function(l,k,m){if(typeof m==="object"){throw new TypeError("Expected number")}var n=l.getLayersBy("id",k)[0];n.setOpacity(m)},mapResized:function(k){k.updateSize();for(var l=0;l<k.layers.length;l++){k.layers[l].redraw(true)}},setMapMarker:function(m,u,r,k,s){var n=m.getLayersBy("name",r);var v=m.getLonLatFromPixel(u);var w=new OpenLayers.Size(s.width,s.height);var p=new OpenLayers.Pixel(-(w.w/2),-w.h);var t=new OpenLayers.Icon(k,w,p);var q=new OpenLayers.Marker(v,t.clone());q.map=m;var l=h.generateUuid();q.id=l;if(n!=null&&n.length>0&&typeof n[0].addMarker==="function"){n[0].addMarker(q)}else{var o=new OpenLayers.Layer.Markers(r);m.addLayer(o);o.addMarker(q)}return{id:l,groupName:r}},removeMapMarker:function(l,p){for(var o=0;o<l.layers.length;o++){var n=l.layers[o];if(n.markers!=null&&n.markers.length>0){for(var m=0;m<n.markers.length;m++){var k=n.markers[m];if(k.id===p){n.removeMarker(k);break}}break}}},getLonLatFromPixel:function(n,m,o,l){if(m==null){throw new ReferenceError("'x' value cannot be null or undefined")}if(o==null){throw new ReferenceError("'y' value cannot be null or undefined")}var k=n.getLonLatFromPixel({x:m,y:o});if(l){k=k.transform(n.projection,l)}else{if(d.displayProjection&&d.displayProjection!==n.projection){k=k.transform(n.projection,d.displayProjection)}}return k},getPixelFromLonLat:function(k,m,l){if(m==null){throw new ReferenceError("'lon' value cannot be null or undefined")}if(l==null){throw new ReferenceError("'lat' value cannot be null or undefined")}var n=new OpenLayers.LonLat(m,l);if(d.displayProjection&&d.displayProjection!==k.projection){n=n.transform(d.displayProjection,k.projection)}return k.getPixelFromLonLat(n)},getPointFromEvent:function(k){return{x:k.xy.x,y:k.xy.y}},drawPolyLine:function(l,s,n,r){var k=new OpenLayers.Geometry.Point(s[0].lon,s[0].lat);var q=new OpenLayers.Geometry.Point(s[1].lon,s[1].lat);var p=r||"EPSG:4326";var m=new OpenLayers.Layer.Vector(n);var t=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([q,k]).transform(new OpenLayers.Projection(p),l.getProjection()));var o=OpenLayers.Util.applyDefaults(o,OpenLayers.Feature.Vector.style["default"]);o.strokeWidth=4;t.style=o;m.addFeatures([t]);l.addLayer(m)},startRemoveSelectedFeature:function(m,n){var p=m.getLayersByName(n);var k;if(p.length>0){k=p[0]}else{j.warn('Layer not found ("'+n+'") when starting the selection to remove features.');return}function l(q){k.removeFeatures(q)}var o=new OpenLayers.Control.SelectFeature(k,{onSelect:l});m.addControl(o);o.activate();c(m,"removeFeaturesControl",o)},stopRemoveSelectedFeature:function(k){var l=a(k,"removeFeaturesControl");if(l!=null){l.deactivate();k.removeControl(l);c(k,"removeFeaturesControl",null)}},removeFeature:function(k,l,m){var n=k.getLayersByName(l);n[0].removeFeatures(m)},startDrawingOnLayer:function(l,n,m){var p=l.getLayersByName(n||m.layerName);var k;if(p.length>0){k=p[0]}else{k=new OpenLayers.Layer.Vector(n||m.layerName);l.addLayer(k)}k.style={fillColor:m.fillColor||m.color,fillOpacity:m.fillOpacity||m.opacity,pointRadius:m.pointRadius||m.radius,strokeColor:m.strokeColor||m.color,strokeOpacity:m.strokeOpacity||m.opacity};var o=a(l,"drawingControl");if(!o){var q;if(m.featureType.toLowerCase()==="point"){q=new OpenLayers.Control.DrawFeature(k,OpenLayers.Handler.Point)}else{if(m.featureType.toLowerCase()==="line"||m.featureType.toLowerCase()==="linestring"){q=new OpenLayers.Control.DrawFeature(k,OpenLayers.Handler.Path)}else{if(m.featureType.toLowerCase()==="box"){q=new OpenLayers.Control.DrawFeature(k,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:true}})}else{if(m.featureType.toLowerCase()==="polygon"){q=new OpenLayers.Control.DrawFeature(k,OpenLayers.Handler.Polygon)}}}}if(m.featureType.toLowerCase()==="circle"){throw new Error("'startDrawingOnLayer' failed due to feature type 'Circle' is not a valid feature type for OpenLayers 2.")}c(l,"drawingControl",q);l.addControl(q);q.activate()}},stopDrawing:function(k){var l=a(k,"drawingControl");if(l){l.deactivate();k.removeControl(l);c(k,"drawingControl",null)}},drawLabel:function(l,p,q){var r=l.getLayersByName(p||q.layerName);var m;if(r.length>0){m=r[0]}else{m=new OpenLayers.Layer.Vector(p||q.layerName);l.addLayer(m)}var t=new OpenLayers.Geometry.Point(q.lon,q.lat).transform(new OpenLayers.Projection(q.projection),l.getProjection());var s=new OpenLayers.Feature.Vector(t);m.style={label:q.text,fontColor:q.fontColor||q.color,fontSize:q.fontSize,align:q.align,labelSelect:true};m.addFeatures([s]);var o=h.generateUuid();s.id=o;var n=new OpenLayers.Format.GeoJSON();var k=n.write(s);var u=angular.fromJson(k);u.id=o;return u},drawLabelWithPoint:function(l,p,q){var r=l.getLayersByName(p||q.layerName);var m;if(r.length>0){m=r[0]}else{m=new OpenLayers.Layer.Vector(p||q.layerName);l.addLayer(m)}var t=new OpenLayers.Geometry.Point(q.lon,q.lat).transform(new OpenLayers.Projection(q.projection),l.getProjection());var s=new OpenLayers.Feature.Vector(t);var n=h.generateUuid();s.id=n;m.style={label:q.text,pointRadius:q.pointRadius||"8",fontColor:q.fontColor||q.color||"#000000",fontSize:q.fontSize||"14px",align:q.align||"cm",labelYOffset:q.labelYOffset||15,labelSelect:true,fillColor:q.pointColor||q.color||"#000000",strokeColor:q.pointColor||q.color||"#000000",fillOpacity:q.pointOpacity||q.fillOpacity||0.5,strokeOpacity:q.pointOpacity||q.strokeOpacity||1};m.addFeatures([s]);var o=new OpenLayers.Format.GeoJSON();var k=o.write([s]);var u=angular.fromJson(k);u.features[0].id=n;return u},getFeatureInfo:function(o,l,u,t,q,r,v){v=v||0;var A=f.defer();var y=event instanceof MouseEvent?r.xy:r;var x=new OpenLayers.Pixel(y.x,y.y);var p=x.add(-v,v);var n=x.add(v,-v);var w=o.getLonLatFromPixel(p);var s=o.getLonLatFromPixel(n);var k=new OpenLayers.Bounds(w.lon,w.lat,s.lon,s.lat);var z=new OpenLayers.Protocol.WFS({formatOptions:{outputFormat:"text/xml"},url:l,version:"1.1.0",srsName:o.projection,featureType:u,featurePrefix:t,geometryName:q,maxFeatures:100});var m=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:k});z.read({filter:m,callback:function(C){if(C.success()){var E=new OpenLayers.Format.GeoJSON();var B=E.write(C.features);var F=angular.fromJson(B);for(var D=0;D<F.features.length;D++){F.features[D].crs={type:"name",properties:{name:o.projection}}}A.resolve(F)}}});return A.promise},getFeatureInfoFromLayer:function(n,y,r,p,u){u=u||0;var x=event instanceof MouseEvent?p.xy:p;var w=new OpenLayers.Pixel(x.x,x.y);var o=w.add(-u,u);var m=w.add(u,-u);var v=n.getLonLatFromPixel(o);var q=n.getLonLatFromPixel(m);var k=new OpenLayers.Bounds(v.lon,v.lat,q.lon,q.lat);var s=n.getLayersBy("id",r);var t;if(s.length>0){t=s[0]}else{throw new Error("Invalid layer id")}var z=OpenLayers.Protocol.WFS.fromWMSLayer(t);var l=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:k});z.read({filter:l,callback:function(B){if(B.success()){var D=new OpenLayers.Format.GeoJSON();var A=D.write(B.features);var E=angular.fromJson(A);for(var C=0;C<E.features.length;C++){E.features[C].crs={type:"name",properties:{name:n.projection}}}y(E)}}})},createWfsClient:function(m,p,o,l,r,n,k){var q=new OpenLayers.Protocol.WFS({url:m,featureType:p,featurePrefix:o,version:l,geometryName:r,srsName:n});q.isLonLatOrderValid=k;return q},addWfsClient:function(l){d.wfsClientCache=d.wfsClientCache||[];var k=h.generateUuid();d.wfsClientCache[k]=l;return{clientId:k}},is3dSupported:function(l,k){return false},is3d:function(l,k){return false},switchTo3dView:function(l,k){throw new Error("3D not supported in current map")},switchTo2dView:function(l,k){},searchWfs:function(o,k,r,q){var m=d.wfsClientCache[k];var n=f.defer();var l=function(t){if(t.priv.status!=="200"||t.priv.status===200){n.resolve(null);return}for(var v=0;v<t.features.length;v++){if(d.wfsClientCache[k].isLonLatOrderValid===false){var x=t.features[v].geometry.x;var y=t.features[v].geometry.y;t.features[v].geometry.x=y;t.features[v].geometry.y=x}}var w=new OpenLayers.Format.GeoJSON();var s=w.write(t.features);var z=angular.fromJson(s);for(var u=0;u<z.features.length;u++){z.features[u].crs={type:"name",properties:{name:m.srsName}}}n.resolve(z)};var p=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:q,matchCase:false,value:r.toUpperCase()+"*"});m.read({filter:p,callback:l});return n.promise},getMeasureFromEvent:function(k,o){var m;var n=new OpenLayers.Format.GeoJSON({externalProjection:d.displayProjection,internalProjection:k.projection});var l=n.write(o.geometry);m=angular.fromJson(l);return{measurement:o.measure,units:o.units,geoJson:m}},wfsClientCache:{}};function g(l,p){for(var k in p.postAddLayerCache){if(p.postAddLayerCache.hasOwnProperty(k)){var m=false;for(var o=0;o<l.layers.length;o++){var n=l.layers[o];if(k===n.id){m=true}}if(!m){p.postAddLayerCache[k]=null}}}}return d}]);(function(){var c=angular.module("gawebtoolkit.mapservices.map.openlayersv3",["gawebtoolkit.mapservices.layer.openlayersv3","gawebtoolkit.mapservices.controls.openlayersv3"]);var b;var a;c.service("olv3MapService",["olv3LayerService","olv3MapControls","GAWTUtils","GeoLayer","ga.config","$q","$log","$timeout",function(d,m,l,g,n,j,o,f){function h(s,r,q){var p=s.get("_geowebtoolkit")||{};p[r]=q;s.set("_geowebtoolkit",p)}function e(s,r){var p=null;if(s.get("_geowebtoolkit")){var q=s.get("_geowebtoolkit");p=q[r]}return p}var i={initialiseMap:function(t,v){var s={};var r={};if(t.datumProjection==null){o.warn("Datum projection has not been provided. Defaulting to EPSG:3857");t.datumProjection="EPSG:3857"}if(t.displayProjection==null){o.warn("Display projection has not been provided. Defaulting to EPSG:4326");t.displayProjection="EPSG:4326"}r.projection=ol.proj.get(t.datumProjection);if(t.centerPosition){var p=JSON.parse(t.centerPosition);r.center=ol.proj.transform([p[0],p[1]],t.displayProjection,t.datumProjection)}r.zoom=parseInt(t.zoomLevel);r.extent=r.projection.getExtent();var q=new ol.View(r);q.geoMaxZoom=28;q.geoMinZoom=0;s.target=t.mapElementId;s.renderer=n.olv3Options==null?"canvas":(n.olv3Options.renderer||"canvas");s.view=q;if(t.isStaticMap){s.interactions=[]}s.controls=[];i.displayProjection=t.displayProjection;var u=new ol.Map(s);window.setTimeout(function(){if(t.initialExtent){var w=[t.initialExtent[0][0],t.initialExtent[0][1],t.initialExtent[1][0],t.initialExtent[1][1]];var x=ol.proj.transformExtent(w,t.displayProjection,t.datumProjection);u.getView().fitExtent(x,u.getSize())}},10);return u},getParameterByName:function(p){p=p.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+p+"=([^&#]*)"),q=r.exec(document.URL);return q==null?"":decodeURIComponent(q[1].replace(/\+/g," "))},zoomToMaxExtent:function(p){p.getView().setZoom(18)},currentZoomLevel:function(p){return p.getView().getZoom()},addLayer:function(p,t){var u=t.geoMaxZoom||p.getView().geoMaxZoom;var r=t.geoMinZoom||p.getView().geoMinZoom;if(u<p.getView().geoMaxZoom||r>p.getView().geoMinZoom){var s=p.getView();var q={projection:s.getProjection(),center:s.getCenter(),zoom:s.getZoom(),maxZoom:u,minZoom:r};var v=new ol.View(q);p.setView(v)}if(t.disableDefaultUI){return}if(t.then!=null&&typeof t.then==="function"){t.then(function(w){p.addLayer(w);i.postLayerAddAction(p,t);return g.fromOpenLayersV3Layer(t)})}else{if(t.geoLayerType!=null&&t.geoLayerType.indexOf("Google")!==-1){p.zoomDuration=0}p.addLayer(t);i.postLayerAddAction(p,t);return g.fromOpenLayersV3Layer(t)}},postLayerAddAction:function(p,q){o.info("post layer add fired");if(d.postAddLayerCache[q.id]){d.postAddLayerCache[q.id]({map:p,layer:q})}k(p,d)},registerMapMouseMove:function(p,q){$(p.getViewport()).on("mousemove",q)},registerMapClick:function(p,q){if(q!=null){p.on("click",q)}},unRegisterMapClick:function(p,q){if(q!=null){p.un("click",q)}},registerMapMouseMoveEnd:function(p,q){$(p.getViewport()).on("mousemove",function(s,r){if(i.mousemoveTimeout!==undefined){window.clearTimeout(i.mousemoveTimeout)}i.mousemoveTimeout=window.setTimeout(function(){q(s,r)},100)})},registerMapEvent:function(q,p,r){q.on(p,r)},unRegisterMapEvent:function(q,p,r){q.un(p,r)},getCurrentMapExtent:function(q){var v=q.getView().calculateExtent(q.getSize());if(v==null){return null}var p=[];var u=ol.proj.transform([v[0],v[3]],q.getView().getProjection(),i.displayProjection);var t=ol.proj.transform([v[2],v[3]],q.getView().getProjection(),i.displayProjection);var r=ol.proj.transform([v[0],v[1]],q.getView().getProjection(),i.displayProjection);var s=ol.proj.transform([v[2],v[1]],q.getView().getProjection(),i.displayProjection);p.push(u);p.push(t);p.push(r);p.push(s);return p},isControlActive:function(q,s,u){if(u==="measureline"){return i.measureEventDrawInteraction!=null}var p=q.getControls();for(var r=0;r<p.getLength();r++){var t=p.item(r);if(t.get("id")===s){return true}}return false},addControl:function(r,u,v,t,x,s){u=u.toLowerCase();var w={};var p;if(t){p=$("#"+t)[0]}if(u==="mouseposition"){v=v||{}}if(u==="overviewmap"&&v!=null&&v.maximized!=null){v.collapsed=!v.maximized}var q=m.createControl(u,v,p,s);q.set("id",x||q.get("id")||l.generateUuid());q.set("name",u||"");if(u==="overviewmap"){f(function(){r.addControl(q)},1000)}else{r.addControl(q)}w.id=q.get("id");return w},getControls:function(q){var p=[];var r=q.getControls();for(var s=0;s<r.getLength();s++){var t=r.item(s);p.push({id:t.metadata.id||t.get("id"),name:t.metadata.type})}return p},getControlById:function(r,t){var p;var q=r.getControls();for(var s=0;s<q.getLength();s++){var u=q.item(s);if(u.get("id")===t){p=u;break}}return p},activateControl:function(p,s){var r=i.isControlActive(p,s);var q=i._getCachedControl(s);if(!r&&q){p.addControl(q);i._removeCachedControl(s)}},_getCachedControl:function(r){i.cachedControls=i.cachedControls||[];for(var q=0;q<i.cachedControls.length;q++){var p=i.cachedControls[q];if(p.get("id")===r){return p}}return null},_removeCachedControl:function(r){i.cachedControls=i.cachedControls||[];for(var q=0;q<i.cachedControls.length;q++){var p=i.cachedControls[q];if(p.get("id")===r){i.cachedControls[q]=null}}return null},deactivateControl:function(p,t){var r=i.isControlActive(p,t);var q=i._getCachedControl(t);var s=i.getControlById(p,t);if(r&&!q){i.cachedControls.push(s);p.removeControl(s)}},registerControlEvent:function(s,t,r,u){var q=s.getControls();var p=null;q.forEach(function(v){if(v.get("id")===t){p=v}});if(p==null){if(r==="measurepartial"){i.initMeasureEventLayer(s);i.handleMeasurePartial(s,i.measureEventVectorLayer,i.measureEventDrawInteraction,u)}if(r==="measure"){i.initMeasureEventLayer(s);i.handleMeasure(s,i.measureEventVectorLayer,i.measureEventDrawInteraction,u)}}else{p.on(r,u)}},initMeasureEventLayer:function(p){if(i.measureEventVectorLayer){p.removeLayer(i.measureEventVectorLayer)}if(i.measureEventDrawInteraction){p.removeInteraction(i.measureEventDrawInteraction)}i.measureEventSource=i.measureEventSource||new ol.source.Vector();i.measureEventVectorLayer=i.measureEventVectorLayer||new ol.layer.Vector({source:i.measureEventSource,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});i.measureEventVectorLayer.set("id",l.generateUuid());i.measureEventDrawInteraction=i.measureEventDrawInteraction||new ol.interaction.Draw({source:i.measureEventSource,type:"LineString",style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})});p.addLayer(i.measureEventVectorLayer);p.addInteraction(i.measureEventDrawInteraction)},handleMeasurePartial:function(p,q,r,s){r.on("drawstart",function(u){var t=false;var v=u.feature;i.measurePointerMoveEvent=function(w){t=!!w.dragging};i.measureSingleClickTimeout=null;i.measurePointerUpEvent=function(w){if(i.measureSingleClickTimeout){f.cancel(i.measureSingleClickTimeout)}if(!t){i.measureSingleClickTimeout=f(function(){if(!i.measureIsDrawEndComplete){w.feature=v;s(w)}else{i.measureIsDrawEndComplete=false}},10)}};i.measurePointerDownEvent=function(x){var w=new Date(new Date()+250);if(!t&&i.measureSingleClickTimeout!=null&&w<i.measureSingleClickTimeout){i.measureIsDoubleClick=true}i.measureSingleClickTimeout=new Date()};p.on("pointerup",i.measurePointerUpEvent);p.on("pointermove",i.measurePointerMoveEvent);p.on("pointerdown",i.measurePointerDownEvent);s(u)},i)},handleMeasure:function(p,q,r,s){i.measureIsDrawEndComplete=false;r.on("drawend",function(t){p.un("pointerup",i.measurePointerUpEvent);p.un("pointermove",i.measurePointerMoveEvent);p.un("pointermove",i.measurePointerDownEvent);s(t);i.measureIsDrawEndComplete=true},i)},unRegisterControlEvent:function(s,t,r,u){var q=s.getControls();var p=null;q.forEach(function(v){if(v.get("id")===t){p=v}});if(p==null){if(r==="measure"&&i.measureEventDrawInteraction){s.removeInteraction(i.measureEventDrawInteraction);s.removeLayer(i.measureEventVectorLayer);i.measureEventVectorLayer=null;i.measureEventDrawInteraction=null;i.measureEventSource=null;s.un("pointerup",i.measurePointerUpEvent);s.un("pointermove",i.measurePointerMoveEvent);s.un("pointermove",i.measurePointerDownEvent)}if(r==="measurepartial"&&i.measureEventDrawInteraction){s.removeInteraction(i.measureEventDrawInteraction);s.removeLayer(i.measureEventVectorLayer);i.measureEventVectorLayer=null;i.measureEventDrawInteraction=null;i.measureEventSource=null;s.un("pointerup",i.measurePointerUpEvent);s.un("pointermove",i.measurePointerMoveEvent);s.un("pointermove",i.measurePointerDownEvent)}}else{p.un(r,u)}},getLayers:function(p){var q=[];angular.forEach(p.getLayers(),function(r){q.push(g.fromOpenLayersV3Layer(r))});return q},_getLayersBy:function(r,q,p){var t=r.getLayers();var s=[];t.forEach(function(v){var u=v.get(q);if(u&&u.indexOf(p)!==-1){s.push(v)}});return s},getLayersByName:function(p,q){if(typeof q!=="string"&&typeof q!=="number"){throw new TypeError("Expected string or number")}return d.getLayersBy(p,"name",q)},setLayerVisibility:function(r,q,p){if(typeof p!=="string"&&typeof p!=="boolean"){throw new TypeError('Invalid visibility value "'+p+'"')}var s=d.getLayerBy(r,"id",q);s.setVisible(p)},createBoundingBox:function(p,s){var t=[];for(var r=0;r<s.length;r++){var u=s[r];t.push(new ol.geom.Point(u))}var q=new ol.geom.GeometryCollection(t);return q.getExtent()},createBounds:function(r,t,p){if(p){var q=r.getView();var u=ol.proj.transform([t[0][0],t[0][1]],q.getProjection(),p);var s=ol.proj.transform([t[0][0],t[0][1]],q.getProjection(),p);return[u[0],u[1],s[0],s[1]]}return[t[0][0],t[0][1],t[1][0],t[1][1]]},zoomToExtent:function(p,q){},zoomToLayer:function(q,p){var r=d.getLayerBy(q,"id",p);if(r==null){throw new ReferenceError('Layer not found - id: "'+p+'".')}var s=r.getExtent();if(s==null){return}q.getView().fitExtent(s,q.getSize())},zoomTo:function(p,q){if(typeof q==="object"){throw new TypeError("Expected number")}p.getView().setZoom(q)},setBaseLayer:function(q,p){var r=i._getLayersBy(q,"isBaseLayer",true);r.forEach(function(s){if(s.get("id")===p){s.setVisible(true)}else{s.setVisible(false)}})},setCenter:function(s,t,u,q){var p=[u,t];if(q==null){s.getView().setCenter(p)}else{var r=ol.proj.transform(p,q,s.getView().getProjection());s.getView().setCenter(r)}},setInitialPositionAndZoom:function(p,q){if(i.getParameterByName("zoom")!==""&&q.centerPosition!=null){throw new Error("NotImplemented")}},isBaseLayer:function(r,q){var u=r.getLayers();var p=null;var s=0;var t=false;u.forEach(function(v){if(v.get("id")===q&&!t){p=s;t=true}s++});return p===0},setOpacity:function(q,p,r){if(typeof r==="object"){throw new TypeError("Expected number")}var s=d.getLayerBy(q,"id",p);s.setOpacity(r)},mapResized:function(p){p.updateSize();for(var q=0;q<p.getLayers().length;q++){p.getLayers()[q].redraw(true)}},setMapMarker:function(t,z,u,q,y){var x=d.getLayerBy(t,"name",u);var w=t.getCoordinateFromPixel([z.x,z.y]);var s=new ol.Feature({geometry:new ol.geom.Point(w)});var r=l.generateUuid();s.setId(r);var v=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:y.opacity||1,src:q}))});s.setStyle(v);if(x!=null){x.getSource().addFeature(s)}else{var p=new ol.source.Vector();p.addFeature(s);x=new ol.layer.Vector({source:p,format:new ol.format.GeoJSON()});x.set("name",u);t.addLayer(x)}return{id:r,groupName:u}},removeMapMarker:function(q,u){for(var t=0;t<q.getLayers().getLength();t++){var s=q.getLayers().item(t);var v=s.getSource();if(typeof v.getFeatures==="function"&&v.getFeatures().length>0){for(var r=0;r<v.getFeatures().length;r++){var p=v.getFeatures()[r];if(p.getId()===u){v.removeFeature(p);break}}break}}},getLonLatFromPixel:function(s,r,t,q){if(r==null){throw new ReferenceError("'x' value cannot be null or undefined")}if(t==null){throw new ReferenceError("'y' value cannot be null or undefined")}var p=s.getCoordinateFromPixel([r,t]);if(q){p=ol.proj.transform(p,s.getView().getProjection(),q)}else{if(i.displayProjection&&i.displayProjection!==s.getView().getProjection()){p=ol.proj.transform(p,s.getView().getProjection(),i.displayProjection)}}return{lon:p[0],lat:p[1]}},getPixelFromLonLat:function(q,s,r){if(s==null){throw new ReferenceError("'lon' value cannot be null or undefined")}if(r==null){throw new ReferenceError("'lat' value cannot be null or undefined")}var t=[s,r];if(i.displayProjection!==q.getView().getProjection().getCode()){t=ol.proj.transform(t,i.displayProjection,q.getView().getProjection())}var p=q.getPixelFromCoordinate(t);if(p==null){q.renderSync()}p=q.getPixelFromCoordinate(t);return{x:p[0],y:p[1]}},getPointFromEvent:function(p){return{x:p.pixel[0],y:p.pixel[1]}},drawPolyLine:function(s,A,u,z){if(!u){u=l.generateUuid()}var w=d._getLayersBy(s,"name",u);var t;var p=new ol.source.Vector();var q=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})});var r=[A[0].lon,A[0].lat];var y=[A[1].lon,A[1].lat];var x=new ol.geom.LineString([r,y]);var v=z||"EPSG:4326";x.transform(v,s.getView().getProjection());var B=new ol.Feature({geometry:x,name:u});B.setId(l.generateUuid());if(w.length>0){t=w[0];if(!(t.getSource().addFeature instanceof Function)){throw new Error("Layer name '"+u+"' corresponds to a layer with an invalid source. Layer source must support features.")}t.setStyle(q)}else{t=new ol.layer.Vector({source:p,style:q,format:new ol.format.GeoJSON()});t.set("name",u);s.addLayer(t)}t.getSource().addFeature(B)},startRemoveSelectedFeature:function(q,r){var t=d._getLayersBy(q,"name",r);if(!t||t.length===0){o.warn('Layer "'+r+"' not found. Remove selected layer interaction not added.");return}var s=t[0];var p=new ol.interaction.Select();p.on("select",function(B){var A=s.getSource();if(A.removeFeature instanceof Function){if(B.selected instanceof Array){for(var w=0;w<B.selected.length;w++){var v=B.selected[w];for(var u=0;u<A.getFeatures().length;u++){var y=A.getFeatures()[u];if(y.get("id")===v.get("id")){A.removeFeature(y)}}}}else{for(var x=0;x<A.getFeatures().length;x++){var z=A.getFeatures()[x];if(z.get("id")===B.selected.get("id")){A.removeFeature(z);break}}}}else{throw new Error("No valid layer found with name - "+r+" - to remove selected features.")}p.getFeatures().clear()});q.addInteraction(p);h(q,"removeFeaturesControl",p)},stopRemoveSelectedFeature:function(p){var q=e(p,"removeFeaturesControl");if(q){p.removeInteraction(q);h(p,"removeFeaturesControl",null)}},removeFeature:function(p,q,r){var s=d.getLayersBy(p,"name",q);s.removeFeatures(r)},startDrawingOnLayer:function(s,u,v){var y=e(s,"removeFeaturesControl");if(y){s.removeInteraction(y)}var r;switch(v.featureType.toLowerCase()){case"point":r="Point";break;case"line":case"linestring":r="LineString";break;case"box":case"polygon":r="Polygon";break;case"circle":r="Circle"}var w=d._getLayersBy(s,"name",u||v.layerName);var t;var p=new ol.source.Vector();var q=new ol.style.Style({fill:new ol.style.Fill({color:v.fillColor||v.color,radius:v.fillRadius||v.radius}),stroke:new ol.style.Stroke({color:v.strokeColor||v.color,width:v.strokeRadius||v.radius,opacity:v.strokeOpacity||v.opacity}),image:new ol.style.Circle({radius:v.circleRadius||v.radius,fill:new ol.style.Fill({color:v.circleColor||v.color})})});if(w.length>0){t=w[0];if(!(t.getSource().addFeature instanceof Function)){throw new Error("Layer name '"+u||v.layerName+"' corresponds to a layer with an invalid source. Layer source must support features.")}t.setStyle(q);p=t.getSource()}else{t=new ol.layer.Vector({source:p,style:q,format:new ol.format.GeoJSON()});t.set("name",u||v.layerName);s.addLayer(t)}var z=e(s,"featureDrawingInteraction");if(!z){var x=new ol.interaction.Draw({source:p,type:(r),format:new ol.format.GeoJSON()});x.on("drawend",function(A){if(A.feature){A.feature.set("id",l.generateUuid())}});h(s,"featureDrawingInteraction",x);s.addInteraction(x)}},stopDrawing:function(p){var q=e(p,"featureDrawingInteraction");if(q){p.removeInteraction(q);h(p,"featureDrawingInteraction",null)}},drawLabel:function(s,u,w){var x=d._getLayersBy(s,"name",u||w.layerName);var t;var p=new ol.source.Vector();var z=w.align==="cm"?"center":w.align||w.textAlign;var v=new ol.style.Text({textAlign:z,textBaseline:w.baseline,font:(w.fontWeight||w.weight||"normal")+" "+(w.fontSize||w.size||"12px")+" "+(w.font||"sans-serif"),text:w.text,fill:new ol.style.Fill({color:w.fillColor||w.color,width:w.fillWdith||w.width||1}),stroke:new ol.style.Stroke({color:w.outlineColor||w.color,width:w.outlineWidth||w.width||1}),offsetX:w.offsetX||0,offsetY:w.offsetY||(w.labelYOffset*-1)||15,rotation:w.rotation});var q=new ol.style.Style({image:new ol.style.Circle({radius:w.circleRadius||w.radius,fill:new ol.style.Fill({color:w.fillColor||w.color||"#000000"}),stroke:new ol.style.Stroke({color:w.strokeColor||w.color||"#000000",width:w.strokeRadius||w.radius})}),text:v});if(x.length>0){t=x[0];if(!(t.getSource().addFeature instanceof Function)){throw new Error("Layer name '"+u||w.layerName+"' corresponds to a layer with an invalid source. Layer source must support features.")}}else{t=new ol.layer.Vector({source:p,style:q,format:new ol.format.GeoJSON()});t.set("name",u||w.layerName);s.addLayer(t)}var r=ol.proj.transform([w.lon,w.lat],(w.projection||i.displayProjection),s.getView().getProjection());var B=new ol.geom.Point(r);var y=new ol.Feature({geometry:B});y.setId(l.generateUuid());y.setStyle(q);t.getSource().addFeature(y);var A=new ol.format.GeoJSON();return angular.fromJson(A.writeFeature(y))},drawLabelWithPoint:function(z,H,s){var y=d._getLayersBy(z,"name",H||s.layerName);var r;var B=new ol.source.Vector();var p=s.align==="cm"?"center":s.align||s.textAlign;var x=new ol.style.Text({textAlign:p,textBaseline:s.baseline,font:(s.fontWeight||s.weight||"normal")+" "+(s.fontSize||s.size||"12px")+" "+(s.font||"sans-serif"),text:s.text,fill:new ol.style.Fill({color:s.fillColor||s.color,width:s.fillWdith||s.width||1}),stroke:new ol.style.Stroke({color:s.outlineColor||s.color,width:s.outlineWidth||s.width||1}),offsetX:s.offsetX||0,offsetY:s.offsetY||(s.labelYOffset*-1)||15,rotation:s.rotation});var v;var I=s.fillColor||s.color||"#000000";var E=s.fillOpacity||s.opacity||0.5;if(I.indexOf("#")===0){v=l.convertHexAndOpacityToRgbArray(I,E)}else{v=s.fillColor||s.color}var C;var t=s.fillColor||s.color||"#000000";var u=s.strokeOpacity||s.opacity||1;if(t.indexOf("#")===0){C=l.convertHexAndOpacityToRgbArray(t,u)}else{C=s.strokeColor||s.color}var G=new ol.style.Style({image:new ol.style.Circle({radius:s.pointRadius||s.radius||"2",fill:new ol.style.Fill({color:v}),stroke:new ol.style.Stroke({color:C,width:s.strokeRadius||s.radius})}),text:x});if(y.length>0){r=y[0];if(!(r.getSource().addFeature instanceof Function)){throw new Error("Layer name '"+H||s.layerName+"' corresponds to a layer with an invalid source. Layer source must support features.")}}else{r=new ol.layer.Vector({source:B,format:new ol.format.GeoJSON()});r.set("name",H||s.layerName);z.addLayer(r)}var A=ol.proj.transform([s.lon,s.lat],(s.projection||i.displayProjection),z.getView().getProjection());var D=new ol.geom.Point(A);var q=new ol.Feature({geometry:D});q.setId(l.generateUuid());q.setStyle(G);r.getSource().addFeature(q);var w=[q];var F=new ol.format.GeoJSON();return angular.fromJson(F.writeFeatures([q]))},getFeatureInfo:function(t,q,z,y,v,w,A){if(OpenLayers==null){throw new Error("NotImplemented")}o.warn("getFeatureInfo not implemented for OpenLayers version 3, falling back to OpenLayers v2 to get GeoJSON features from server");A=A||0;var F=j.defer();var D=(w instanceof ol.MapBrowserPointerEvent)?w.pixel:w;var C=new OpenLayers.Pixel(D[0],D[1]);var u=C.add(-A,A);var s=C.add(A,-A);var B=t.getCoordinateFromPixel([u.x,u.y]);var x=t.getCoordinateFromPixel([s.x,s.y]);var p=new OpenLayers.Bounds(B[0],B[1],x[0],x[1]);var E=new OpenLayers.Protocol.WFS({formatOptions:{outputFormat:"text/xml"},url:q,version:"1.1.0",srsName:t.getView().getProjection().getCode(),featureType:z,featurePrefix:y,geometryName:v,maxFeatures:100});var r=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:p});E.read({filter:r,callback:function(H){if(H.success()){var J=new OpenLayers.Format.GeoJSON();var G=J.write(H.features);var K=angular.fromJson(G);for(var I=0;I<K.features.length;I++){K.features[I].crs={type:"name",properties:{name:t.getView().getProjection().getCode()}}}F.resolve(K)}}});return F.promise},getFeatureInfoFromLayer:function(y,r,w,s,I){if(OpenLayers==null){throw new Error("NotImplemented")}o.warn("getFeatureInfoFromLayer not implemented for OpenLayers version 3, falling back to OpenLayers v2 to get GeoJSON features from server");I=I||0;var H=(s instanceof ol.SelectEvent)?s.pixel:s;var p=new OpenLayers.Pixel(H.x,H.y);var D=p.add(-I,I);var q=p.add(I,-I);var B=y.getCoordinateFromPixel([D.x,D.y]);var x=y.getCoordinateFromPixel([q.x,q.y]);var u=new OpenLayers.Bounds(B[0],B[1],x[0],x[1]);var v=d._getLayersBy(y,"id",w);var J;if(v.length>0){J=v[0]}else{throw new Error("Invalid layer id")}var z,C;var t=J.getSource().getParams()["LAYERS"];var F=(OpenLayers.Util.isArray(t)?t[0]:t).split(":");if(F.length>1){C=F[0]}z=F.pop();var G={url:J.getSource().getUrls()[0],featureType:z,featurePrefix:C,srsName:J.projection&&J.projection.getCode()||J.map&&J.map.getProjectionObject().getCode(),version:"1.1.0"};var E=new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(null,G));var A=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:u});E.read({filter:A,callback:function(L){if(L.success()){var N=new OpenLayers.Format.GeoJSON();var K=N.write(L.features);var O=angular.fromJson(K);for(var M=0;M<O.features.length;M++){O.features[M].crs={type:"name",properties:{name:y.projection}}}r(O)}}})},createWfsClient:function(r,u,t,q,v,s,p){throw new Error("NotImplemented")},addWfsClient:function(q){i.wfsClientCache=i.wfsClientCache||[];var p=l.generateUuid();i.wfsClientCache[p]=q;return{clientId:p}},is3dSupported:function(p){return window.olcs!=null},is3d:function(p){return b!=null?b.getEnabled():false},switchTo3dView:function(p){if(b){b.setEnabled(true)}else{b=new olcs.OLCesium({map:p,target:p.getTarget()});var r=b.getCesiumScene();if(n.cesiumOptions!=null&&n.cesiumOptions.includeCustomTerrainProvider){var q=new Cesium.CesiumTerrainProvider({url:n.cesiumOptions.customTerrainProviderUrl});r.terrainProvider=q}f(function(){i.syncMapControlsWithOl3Cesium(p,p.getTarget())});b.setEnabled(true)}},switchTo2dView:function(p){if(b){b.setEnabled(false);i.syncMapControlsWithOl3(p,p.getTarget())}},syncMapControlsWithOl3Cesium:function(q,r){var p=q.getControls();var s=$("#"+r)[0];p.forEach(function(w){if(w instanceof ol.control.MousePosition&&s){var v=b.getCesiumScene();var u=v.globe.ellipsoid;var t=new Cesium.ScreenSpaceEventHandler(v.canvas);t.setInputAction(function(x){var A=v.camera.pickEllipsoid(x.endPosition,u);if(A){var z=u.cartesianToCartographic(A);var y=Cesium.Math.toDegrees(z.longitude);var B=Cesium.Math.toDegrees(z.latitude);$(".ol-mouse-position")[0].innerText=w.getCoordinateFormat()([y,B])}},Cesium.ScreenSpaceEventType.MOUSE_MOVE);a=t}if(w instanceof ol.control.ScaleLine){q.render()}})},syncMapControlsWithOl3:function(p,q){},searchWfs:function(q,p,s,r){throw new Error("NotImplemented")},getMeasureFromEvent:function(q,u){if(u.feature==null&&u.geometry==null){throw new Error("Feature cannot be null in Measure event")}if(u.geometry!=null&&u.geometry instanceof Array&&u.geometry.length===2){u.feature=new ol.Feature(new ol.geom.Point(u.geometry))}if(u.geometry!=null&&u.geometry instanceof Array&&u.geometry.length>2){u.feature=new ol.Feature(new ol.geom.LineString(u.geometry))}var x=u.feature.clone();var v=x.getGeometry().transform(q.getView().getProjection(),i.displayProjection);var w=new ol.format.GeoJSON();var s=w.writeFeature(x);var r=angular.fromJson(s);var p=i.getGeometryLength(q,v);var t="m";if(p>1000){t="km";p=(p/1000)}return{measurement:p,units:t,geoJson:r.geometry}},getGeometryLength:function(q,s){var v=s.getCoordinates();var u=0;var p=new ol.Sphere(6378137);for(var r=0,t=v.length-1;r<t;++r){u+=p.haversineDistance(v[r],v[r+1])}return u},wfsClientCache:{}};function k(q,u){for(var p in u.postAddLayerCache){if(u.postAddLayerCache.hasOwnProperty(p)){var r=false;for(var t=0;t<q.getLayers().length;t++){var s=q.getLayers()[t];if(p===s.id){r=true}}if(!r){u.postAddLayerCache[p]=null}}}}return i}])})();var angular=angular||{};var OpenLayers=OpenLayers||{};var console=console||{};var $=$||{};var app=angular.module("gawebtoolkit.mapservices",["gawebtoolkit.mapservices.layer.openlayersv2","gawebtoolkit.mapservices.map.openlayersv2","gawebtoolkit.mapservices.layer.openlayersv3","gawebtoolkit.mapservices.map.openlayersv3","gawebtoolkit.mapservices.data.openlayersv2","gawebtoolkit.mapservices.data.openlayersv3"]);app.factory("GeoLayer",["GAWTUtils",function(b){var a=function(g,e,f,c,d){this.id=g;this.name=e;this.type=f;this.visibility=c;this.opacity=d};a.fromOpenLayersV2Layer=function(d){var f=d.id.indexOf("_ArcGISCache_")===-1;var e;if(f){e=d.geoLayerType}else{e="ArcGISCache"}var c;if(typeof d.opacity==="string"){c=Number(d.opacity)}else{c=d.opacity}return new a(d.id,d.name,e,d.visibility,c)};a.fromOpenLayersV3Layer=function(d){var e=d.geoLayerType;var c;if(typeof d.get("opacity")==="string"){c=Number(d.get("opacity"))}else{c=d.get("opacity")}if(!d.get("id")){d.set("id",b.generateUuid())}return new a(d.get("id"),d.get("name"),e,d.get("visible"),c)};return a}]);angular.module("gawebtoolkit.ui.templates",[]).run(["$templateCache",function(a){a.put("src/main/js/ui/components/base-layer-selector/base-layer-selector.html",'<select title="Base layer selector" fix-ie-select ng-options="layer.id as layer.name for layer in layersData"\n        ng-model="selectedBaseLayerId"></select>\n');a.put("src/main/js/ui/components/deprecated/dialog-toggle.html",'<button type="button" ng-click="toggleDialog()"><div ng-transclude></div></button>');a.put("src/main/js/ui/components/deprecated/layers-dialog.html",'<div ui-jq="dialog" ui-options="dialogConfig" id="{{dialogId}}">\n    <div ng-repeat="layer in layersData">\n        <ga-layer-control map-controller="mapController" layer-data="layer"></ga-layer-control>\n    </div>\n</div>\n');a.put("src/main/js/ui/components/deprecated/search-wfs.html",'<input type="text" class="search-box" ng-model="query"\n       ng-class="{typeAheadLoading:waitingForResponse}" placeholder="{{placeHolder}}"/>\n<input type="image" class="button search-button" ng-click="searchButtonClicked()"\n       accesskey="4" alt="Search using your entered search criteria"\n       title="Search using your entered search criteria"\n       src="{{searchIconUrl}}">');a.put("src/main/js/ui/components/deprecated/static-dialog.html",'<div ui-jq="dialog" ui-options="dialogConfig" id="{{dialogId}}">\n    <div ng-transclude></div>\n</div>');a.put("src/main/js/ui/components/geo-names-place-search/geo-names-place-search.html",'<input type="text" class="search-box" placeholder="Place name search" ng-model="query"\n       ng-class="{typeAheadLoading:waitingForResponse}"\n       typeahead="result as result.properties.name for result in getSearchResults($viewValue)"\n       typeahead-template-url="{{resultTemplateUrl}}"\n       typeahead-on-select="onSelected($item, $model, $label)"\n       typeahead-wait-ms="200" typeahead-editable="true"/>\n<input type="image" class="button search-button" accesskey="4"\n       ng-click="searchButtonClicked()"\n       alt="Search using your entered search criteria" title="Search using your entered search criteria"\n       src="{{searchIconUrl}}"/>');a.put("src/main/js/ui/components/google-place-name-search/google-place-name-search.html",'<input type="text" class="search-box" placeholder="{{placeHolder}}"/>\n<input type="image" class="button search-button" accesskey="4"\n       alt="Search using your entered search criteria" title="Search using your entered search criteria"\n       src="{{searchIconUrl}}"/>');a.put("src/main/js/ui/components/layer-control/layer-control.html",'<label for="{{elementId}}" class="checkbox" style="display:inline-block;width:65%">\n    <input id="{{elementId}}" type="checkbox" ng-model="layerData.visibility" ng-click="layerClicked()"\n           ng-disabled="layerDisabled"/>{{layerData.name}}\n</label>\n<div style="display:inline;width:30%" ng-transclude></div>\n<div ng-show="layerData.visibility" class="gaLayerControlSliderContainer">\n    <ga-layer-opacity-slider\n            map-controller="mapController"\n            layer-opacity="layerData.opacity"\n            layer-id="{{layerData.id}}"\n            layer-disabled="layerDisabled"\n            on-opacity-change="changeOpacity(layerId,opacity)"\n            title-text="Opacity control for layer - {{layerData.name}}">\n    </ga-layer-opacity-slider>\n</div>\n');a.put("src/main/js/ui/components/layer-interaction-toggle/layer-interaction-toggle.html",'<button ng-click="toggleClicked()" class="gaUiToggleOff" type="button">\n    <div ng-transclude></div>\n</button>');a.put("src/main/js/ui/components/layers-drop-down/layers-drop-down.html",'<div>\n    <select fix-ie-select ng-model="selectedModel" ng-change="selectLayer()"\n            ng-options="dropDownLayer.id as dropDownLayer.name for dropDownLayer in layersData">\n    </select>\n</div>');a.put("src/main/js/ui/components/measure-toggle/measure-toggle.html",'<button type="button" ng-click="handleToggle()" class="gaUiToggleOff">\n    <span ng-transclude></span>\n</button>');a.put("src/main/js/ui/components/opacity-slider/opacity-slider.html",'<div ui-jq="slider" ui-options="getSliderOptions()"></div>')}]);(function(){var a=angular.module("gawebtoolkit.ui.components.base-layer-selector",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaBaseLayerSelector",["$timeout",function(b){return{restrict:"E",templateUrl:"src/main/js/ui/components/base-layer-selector/base-layer-selector.html",replace:true,scope:{layersData:"=",mapController:"=",controllerEmitEventName:"@"},controller:["$scope",function(d){var c=this;c.selectBaseLayer=function(e){d.selectedBaseLayerId=e};d.$emit(d.controllerEmitEventName,c)}],link:function(c){c.$watch("selectedBaseLayerId",function(e){if(e!=null){c.mapController.setBaseLayer(e)}});c.$watch("layersData",function(e){if(e){for(var f=0;f<e.length;f++){if(c.layersData[f].visibility===true){d(c.layersData[f])}}}});var d=function(e){b(function(){c.selectedBaseLayerId=e.id})}},transclude:true}}])})();(function(){angular.module("gawebtoolkit.ui.components",["gawebtoolkit.ui.components.opacity-slider","gawebtoolkit.ui.components.layer-control","gawebtoolkit.ui.components.layers-drop-down","gawebtoolkit.ui.components.base-layer-selector","gawebtoolkit.ui.components.google-place-name-search","gawebtoolkit.ui.components.geo-place-name-search","gawebtoolkit.ui.components.layer-interaction-toggle","gawebtoolkit.ui.components.deprecated","gawebtoolkit.ui.components.measure-toggle"])})();(function(){var a=angular.module("gawebtoolkit.ui.components.deprecated",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaDialogToggle",[function(){return{restrict:"E",templateUrl:"src/main/js/ui/components/deprecated/dialog-toggle.html",transclude:true,scope:{gaDialogController:"=",gaToggleClicked:"&"},link:function(b){b.toggleDialog=function(){var c=!b.gaDialogController.isClosed();if(!c){b.gaDialogController.openDialog()}else{b.gaDialogController.closeDialog()}b.gaToggleClicked({dialogController:b.gaDialogController})}}}}]);a.directive("gaStaticDialog",["$timeout","GAWTUtils",function(b,c){return{restrict:"AE",templateUrl:"src/main/js/ui/components/deprecated/static-dialog.html",scope:{controllerEmitEventName:"@",dialogConfig:"=",dialogWindowResize:"&",dialogClosed:"&",dialogOpened:"&"},controller:["$scope",function(e){$(window).bind("resize",function(){if(e.dialogWindowResize!=null){e.dialogConfig=angular.extend(e.dialogConfig,e.dialogWindowResize())}e.dialogConfig.autoOpen=!e.isClosed;$("#"+e.dialogId).dialog(e.dialogConfig)});e.dialogId=c.generateUuid();var d=this;d.openDialog=function(){$("#"+e.dialogId).dialog("open");e.isClosed=false;e.dialogOpened()};d.closeDialog=function(){$("#"+e.dialogId).dialog("close");e.isClosed=true;e.dialogClosed()};d.isClosed=function(){return e.isClosed};e.$emit(e.controllerEmitEventName,d)}],link:function(d){d.$on("$destroy",function(){$("#"+d.dialogId).dialog("destroy").remove()});var e=d.$watch("dialogConfig",function(f){if(f!=null){d.dialogReady=true;$("#"+d.dialogId).bind("dialogclose",function(){d.isClosed=true;b(function(){d.$apply()});d.dialogClosed()});d.isClosed=!f.autoOpen;e()}})},transclude:true}}]);a.directive("gaLayersDialog",["GAWTUtils",function(b){return{restrict:"E",templateUrl:"src/main/js/ui/components/deprecated/layers-dialog.html",scope:{layersData:"=",dialogConfig:"=",mapController:"="},controller:["$scope",function(d){$(window).bind("resize",function(){d.dialogConfig.autoOpen=!d.isClosed;$("#"+d.dialogId).dialog(d.dialogConfig)});d.dialogId=b.generateUuid();d.isClosed=!d.dialogConfig.autoOpen;var c=this;c.openDialog=function(){$("#"+d.dialogId).dialog("open");d.isClosed=false};c.closeDialog=function(){$("#"+d.dialogId).dialog("close");d.isClosed=true};c.isClosed=function(){return d.isClosed};d.$emit("layersDialogReady",c)}],link:function(e,d,c){e.filterBaseLayers=function(f){var g=e.mapController.isBaseLayer(f.id);return !g};e.$on("$destroy",function(){$("#"+e.dialogId).dialog("destroy").remove()});e.$watch(c.uiRefresh,function(){$("#"+e.dialogId).bind("dialogclose",function(){e.isClosed=!e.isClosed})})},transclude:true}}]);a.directive("gaSearchWfs",["$q","$interpolate","$log",function(b,d,c){return{restrict:"EA",templateUrl:"src/main/js/ui/components/deprecated/search-wfs.html",scope:{resultTemplateUrl:"@",mapController:"=",searchEndPoints:"=",onResults:"&",onResultsSelected:"&",onPerformSearch:"&",primaryWfsProperty:"@",searchIconUrl:"@",placeHolder:"@",activateKey:"@"},controller:["$scope",function(e){e.waitingForResponse=false}],link:function(h,g,e){g.bind("keydown",function(m){if(m.keyCode==h.activateKey){h.searchButtonClicked();h.$apply()}});var f=[];var i;h.limitResults=10;h.$watch("searchEndPoints",function(m){if(m){if(h.mapController==null){return}f=[];for(var n=0;n<h.searchEndPoints.length;n++){var o=h.mapController.createWfsClient(h.searchEndPoints[n].url,h.searchEndPoints[n].featureType,h.searchEndPoints[n].featurePrefix,h.searchEndPoints[n].version,h.searchEndPoints[n].geometryName,h.searchEndPoints[n].datumProjection,h.searchEndPoints[n].isLonLatOrderValid);var p=h.mapController.addWfsClient(o);p.endPointId=h.searchEndPoints[n].id;f.push(p);i=h.searchEndPoints[n].featureAttributes}}});if(e.searchEndPoints==null){if(h.mapController!=null){var k=h.mapController.createWfsClient(h.url,h.featureType,h.featurePrefix,h.version,h.geometryName,h.datumProjection);f.push(h.mapController.addWfsClient(k))}}function l(m){return m.replace("'","").replace('"',"").replace("%","").replace("*","")}var j=function(q){q=l(q);h.searchResults=[];var n=b.defer();var p=0;var m=[];h.waitingForResponse=true;for(var o=0;o<f.length;o++){var r=f[o];h.mapController.searchWfs(f[o].clientId,q,i).then(function(t){if(t==null){c.error("Search server is unavailable.");n.resolve([]);return}p++;for(var s=0;s<t.features.length;s++){t.features[s].endPointId=r.endPointId;m.push(t.features[s])}if(p===f.length){n.resolve(m);h.waitingForResponse=false}})}return n.promise};h.getSearchResults=function(m){if(m!=null&&m.length>=3){return j(m).then(function(n){h.onResults({data:n});return n.slice(0,10)})}else{return[]}};h.onSelected=function(m){h.onResultsSelected({item:m})};h.searchButtonClicked=function(){if(typeof h.query==="object"&&h.query.properties!=null){h.query=h.query.properties[h.primaryWfsProperty]}if(h.query!=null){return j(h.query).then(function(m){h.onPerformSearch({data:m});return m})}}},transclude:true}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.geo-place-name-search",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("geoNamesPlaceSearch",["$http","$q","$timeout",function(d,b,c){return{restrict:"E",templateUrl:"src/main/js/ui/components/geo-names-place-search/geo-names-place-search.html",scope:{mapController:"=",searchIconUrl:"@",geoNamesApiKey:"@",zoomLevel:"@",countryCode:"@",resultTemplateUrl:"@",onResults:"&",onResultsSelected:"&",onPerformSearch:"&",activateKey:"@"},controller:["$scope",function(e){}],link:function(g,e){var f=e.find('input[type="text"]')[0];e.bind("keydown",function(i){if(i.keyCode==g.activateKey){if(g.typeAheadSelected){return}g.searchButtonClicked();g.$apply()}});var h=function(l,j){if(typeof l==="object"){l=l.properties.name}g.searchResults=[];var i=b.defer();g.waitingForResponse=true;var k="http://api.geonames.org/searchJSON?q="+encodeURIComponent(l).replace("%20","+")+"&maxRows="+j+"&country="+g.countryCode.toUpperCase()+"&username="+g.geoNamesApiKey;d.get(k).success(function(o){g.waitingForResponse=false;var n=[];for(var m=0;m<o.geonames.length;m++){var p=o.geonames[m];n.push(g.convertGeoNameToGeoJson(p))}i.resolve(n)});return i.promise};g.getSearchResults=function(i){if(!(i!=null&&i.length>=3)){return[]}return h(i,10).then(function(j){if(g.searchInProgress){return[]}g.onResults({data:j});return j})};g.onSelected=function(i){g.typeAheadSelected=true;c(function(){g.typeAheadSelected=false},50);g.onResultsSelected({item:i})};g.searchButtonClicked=function(){g.searchInProgress=true;if(g.query!=null){return h(g.query,50).then(function(i){g.searchInProgress=false;g.onPerformSearch({data:i});return i})}};g.convertGeoNameToGeoJson=function(j){var i={type:"Feature",geometry:{type:"Point",coordinates:[j.lng,j.lat]},crs:{type:"name",properties:{name:"EPSG:4326"}}};i.properties={};for(var k in j){if(j.hasOwnProperty(k)){i.properties[k]=j[k]}}return i}}}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.google-place-name-search",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("googlePlaceNameSearch",[function(){return{restrict:"E",templateUrl:"src/main/js/ui/components/google-place-name-search/google-place-name-search.html",scope:{mapController:"=",searchIconUrl:"@",zoomLevel:"@",countryCode:"@"},controller:["$scope",function(b){}],link:function(d,b){var c=b.find('input[type="text"]')[0];var e=new google.maps.places.Autocomplete(c,{componentRestrictions:{country:d.countryCode}});google.maps.event.addListener(e,"place_changed",function(){var f=e.getPlace();if(!f.geometry){return}d.mapController.zoomTo(d.zoomLevel);d.mapController.setCenter(f.geometry.location.k,f.geometry.location.A,"EPSG:4326")})}}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.layer-control",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaLayerControl",["GAWTUtils",function(c){return{restrict:"E",templateUrl:"src/main/js/ui/components/layer-control/layer-control.html",scope:{layerData:"=",mapController:"=",onVisible:"&",onHidden:"&",onOpacityChange:"&",layerDisabled:"=",onStartLoading:"&",onFinishedLoading:"&"},controller:["$scope",function(d){d.elementId=c.generateUuid()}],compile:function b(){return{post:function d(g){var f=function(){g.onStartLoading({layerId:g.layerData.id})};var h=function(){g.onFinishedLoading({layerId:g.layerData.id})};g.$watch("layerData",function(i){if(i!=null){g.layerData.visibility=g.layerData.visibility===true||g.layerData.visibility==="true";if(g.mapController==null){throw new Error("mapController is not available")}if(g.layerData.id!=null){g.mapController.registerLayerEvent(g.layerData.id,"loadstart",f);g.mapController.registerLayerEvent(g.layerData.id,"loadend",h)}}})},pre:function e(f){f.changeOpacity=function(g,h){f.onOpacityChange({layerId:g,opacity:h})};f.layerClicked=function(){f.layerData.visibility=!f.layerData.visibility;f.mapController.setLayerVisibility(f.layerData.id,f.layerData.visibility);if(f.layerData.visibility){f.onVisible({layerId:f.layerData.id})}else{f.onHidden({layerId:f.layerData.id})}}}}},transclude:true}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.layer-interaction-toggle",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaLayerInteractionToggle",[function(){return{restrict:"E",replace:"true",templateUrl:"src/main/js/ui/components/layer-interaction-toggle/layer-interaction-toggle.html",transclude:true,scope:{toggleIconSource:"@",controllerEmitEventName:"@",toggleOnCallback:"&",toggleOffCallback:"&",onLayerClickCallback:"&",mapController:"=",layerInteractionId:"="},controller:["$scope",function(c){var b=this;b.activate=function(){c.activate()};b.deactivate=function(){c.deactivate()};b.isToggleActive=function(){return c.isToggleOn};c.$emit(c.controllerEmitEventName,b)}],link:function(c,b){c.isToggleOn=false;c.activate=function(){c.mapController.registerMapClick(d);b.removeClass("gaUiToggleOff");b.addClass("gaUiToggleOn");c.isToggleOn=true;c.toggleOnCallback()};c.deactivate=function(){c.mapController.unRegisterMapClick(d);b.removeClass("gaUiToggleOn");b.addClass("gaUiToggleOff");c.isToggleOn=false;c.toggleOffCallback()};c.toggleClicked=function(){c.isToggleOn=!c.isToggleOn;if(c.isToggleOn){c.activate()}else{c.deactivate()}};var d=function(g){var f=c.mapController.getPointFromEvent(g);c.onLayerClickCallback({point:f,interactionId:c.layerInteractionId})}}}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.layers-drop-down",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaLayersDropDown",[function(){return{restrict:"E",templateUrl:"src/main/js/ui/components/layers-drop-down/layers-drop-down.html",replace:false,scope:{layersData:"=",selectedModel:"=",controllerEmitEventName:"@",onSelectedLayerChanged:"&",onLayersInitialised:"&",layerGroupId:"@",includeNone:"@"},controller:["$scope",function(c){var b=this;c.selectLayer=function(){c.onSelectedLayerChanged({layerId:c.selectedModel,groupId:c.layerGroupId})};b.selectLayer=c.selectLayer;c.$emit(c.controllerEmitEventName,b)}],link:function(b){b.$watch("layersData",function(c){if(c&&!b.selectedModel){if(b.includeNone&&b.layersData[0].id!=="$none$"){b.layersData.unshift({id:"$none$",name:"None"})}b.selectedModel=c[0].id;b.onLayersInitialised({layerId:b.selectedModel,groupId:b.layerGroupId})}})},transclude:true}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.measure-toggle",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaMeasureToggle",[function(){return{restrict:"EA",templateUrl:"src/main/js/ui/components/measure-toggle/measure-toggle.html",scope:{resolveStyle:"&",toggleOnCallback:"&",toggleOffCallback:"&",onFinish:"&",onUpdate:"&",mapControlId:"@",controllerEmitEventName:"@",mapController:"="},controller:["$scope",function(c){var b=this;b.activate=function(){c.activate()};b.deactivate=function(){c.deactivate()};b.isToggleActive=function(){return c.mapController.isControlActive(c.mapControlId)};c.$emit(c.controllerEmitEventName,b)}],link:function(c,b){c.handleMeasurements=function(e){var d=c.mapController.getMeasureFromEvent(e);c.onFinish({event:d})};c.handlePartialMeasure=function(e){var d=c.mapController.getMeasureFromEvent(e);c.onUpdate({event:d})};c.activate=function(){c.mapController.activateControl(c.mapControlId);c.mapController.registerControlEvent(c.mapControlId,"measure",c.handleMeasurements);c.mapController.registerControlEvent(c.mapControlId,"measurepartial",c.handlePartialMeasure);b.removeClass("gaUiToggleOff");b.addClass("gaUiToggleOn");c.toggleOnCallback()};c.deactivate=function(){c.mapController.deactivateControl(c.mapControlId);c.mapController.unRegisterControlEvent(c.mapControlId,"measure",c.handleMeasurements);c.mapController.unRegisterControlEvent(c.mapControlId,"measurepartial",c.handlePartialMeasure);b.removeClass("gaUiToggleOn");b.addClass("gaUiToggleOff");c.toggleOffCallback()};c.handleToggle=function(){if(c.mapController.isControlActive(c.mapControlId,"measureline")){c.deactivate()}else{c.activate()}};c.$on("$destroy",function(){c.mapController.unRegisterControlEvent(c.mapControlId,"measure",c.handleMeasurements);c.mapController.unRegisterControlEvent(c.mapControlId,"measurepartial",c.handleMeasurements)})},transclude:true,replace:"true"}}])})();(function(){var a=angular.module("gawebtoolkit.ui.components.opacity-slider",["gawebtoolkit.ui.directives","ui.utils","gawebtoolkit.utils"]);a.directive("gaLayerOpacitySlider",["$timeout",function(b){return{restrict:"E",templateUrl:"src/main/js/ui/components/opacity-slider/opacity-slider.html",replace:true,scope:{layerId:"@",layerOpacity:"=",mapController:"=",layerDisabled:"=",titleText:"@",onOpacityChange:"&"},controller:["$scope",function(c){c.changeOpacitySlide=function(f,d){c.layerOpacity=d.value;b(function(){c.$apply();c.onOpacityChange({layerId:c.layerId,opacity:c.layerOpacity})})};c.getSliderOptions=function(){return{min:0,max:1,range:false,step:0.01,slide:c.changeOpacitySlide,value:c.layerOpacity,disabled:c.layerDisabled}}}],link:function(d,c){d.$watch("layerOpacity",function(f,e){if(f&&e!==f){$(c).slider(d.getSliderOptions())}});b(function(){c.find(".ui-slider-handle").attr("title",d.titleText)})},transclude:true}}])})();var angular=angular||{};var console=console||{};var $=$||{};var google=google||{};angular.module("gawebtoolkit.ui",["gawebtoolkit.ui.directives","gawebtoolkit.ui.templates","gawebtoolkit.ui.components","ui.utils","gawebtoolkit.utils"]);var app=angular.module("gawebtoolkit.ui.directives",["gawebtoolkit.utils"]);app.directive("gaZoomToExtentButton",[function(){return{restrict:"E",template:'<button type="button" ng-click="zoom()"><div ng-transclude></div></button>',scope:{extentPoints:"=",mapController:"=",beforeZoom:"&"},link:function(a){a.zoomTo=function(){var b=a.mapController.createBounds(a.extentPoints);a.beforeZoom({points:b});a.mapController.zoomToExtent(b)}},transclude:true}}]);app.directive("gaZoomToCenterPositionAnchor",[function(){return{restrict:"E",template:'<a ng-click="zoomTo()"><div ng-transclude></div></a>',scope:{geoJsonCoord:"=",projection:"@",mapController:"=",zoomLevel:"@"},link:function(a){a.zoomTo=function(){a.mapController.setCenter(a.geoJsonCoord[1],a.geoJsonCoord[0],a.projection);a.mapController.zoomTo(a.zoomLevel)}},transclude:true}}]);app.directive("gaZoomToLayerButton",[function(){return{restrict:"E",template:'<button type="button" ng-click="zoom()"><div ng-transclude></div></button>',scope:{layerId:"@",mapController:"=",beforeZoom:"&"},link:function(a){a.zoomTo=function(){a.mapController.zoomToLayer(a.layerId)}},transclude:true}}]);app.directive("gaToggle",[function(){var a='<button type="button" ng-click="toggle()"><div ng-transclude></div></button>';return{restrict:"E",replace:"true",template:a,transclude:true,scope:{gaToggleClicked:"&"},link:function(b){b.toggle=function(){b.gaToggleClicked()}}}}]);app.directive("fixIeSelect",function(){return{restrict:"A",controller:["$scope","$element","$timeout",function(b,a,c){b.$watch("options",function(){var e=$("<option>");var d=a.css("width");a.css("width");a.addClass("repaint").removeClass("repaint");e.appendTo(a).remove();c(function(){a.css("width","auto")});e=null})}]}});(function(){var a=angular.module("gawebtoolkit.vendor.bing-layers",["gawebtoolkit.core.layer-services"]);a.directive("gaBingLayer",["$timeout","$compile","GALayerService","$log",function(d,c,b,e){var g=["road","aerial","aerialwithlabels","birdseye","birdseyewithlabels"];var f=function(k){for(var h=0;h<g.length;h++){var j=g[h];if(j===k.toLowerCase()){return true}}return false};return{restrict:"E",require:"^gaMap",scope:{layerType:"@",visibility:"@",wrapDateLine:"@",bingApiKey:"@",controllerEmitEventName:"@"},transclude:false,controller:["$scope",function(i){var h=this;if(i.controllerEmitEventName){i.$emit(i.controllerEmitEventName,h)}return h}],link:function(p,k,o,h){p.framework=h.getFrameworkVersion();p.mapAPI={};p.mapAPI.mapController=h;var m={},l;m=b.defaultLayerOptions(o,p.framework);m.layerType=m.layerType||m.bingLayerType;if(!f(m.layerType)){e.warn("Invalid Bing layer type - "+m.layerType+' used. Defaulting to "Road". Specify default Bing layer type in "ga.config" - bingLayerType');m.layerType="Road"}var n=function(){p.layerReady=true};var j=function(){p.constructionInProgress=true;m.mapElementId=h.getMapElementId();e.info("Bing "+m.layerType+" - constructing...");if(m.bingApiKey==null){throw new Error("Missing Bing Maps API key. Please provide your valid Bing Maps API key using the ga-bing-layer attribute 'bing-api-key'")}l=b.createBingLayer(m,p.framework);h.addLayer(l).then(function(q){p.layerDto=q;n();e.info("construction complete...");p.constructionInProgress=false},function(q){p.$emit(m.layerName+"_error",m);p.onError({message:q,layer:m});n();e.info("construction failed...");p.constructionInProgress=false})};o.$observe("visibility",function(){if(p.layerReady&&h&&p.layerDto!=null&&p.layerDto.id){h.setLayerVisibility(p.layerDto.id,p.visibility==="true")}});o.$observe("layerType",function(){if(p.layerReady&&h&&p.layerDto!=null&&p.layerDto.id){p.initialiseLayer()}});p.initCount=0;function i(){e.info("reconstructing layer...");var q=h.getLayers();var s=null;for(var r=0;r<q.length;r++){if(q[r].id===p.layerDto.id){s=r;break}}if(s!=null){h.removeLayerById(p.layerDto.id);p.layerDto=null;m=b.defaultLayerOptions(o,p.framework);m.initialExtent=h.getInitialExtent();m.format=p.format;if(m.bingApiKey==null){throw new Error("Missing Bing Maps API key. Please provide your valid Bing Maps API key using the ga-bing-layer attribute 'bing-api-key'")}l=b.createBingLayer(m,p.framework);h.addLayer(l).then(function(t){p.layerDto=t;n();if(p.layerDto!=null){var u=s-h.getLayers().length+1;h.raiseLayerDrawOrder(p.layerDto.id,u)}})}}p.initialiseLayer=function(){e.info("initialising layer...");if(p.layerDto!=null){i()}else{if(p.layerReady&&p.constructionInProgress){e.info("...")}else{j()}}};p.$on("$destroy",function(){if(p.layerDto){h.removeLayerById(p.layerDto.id)}$(window).off("resize.Viewport")});p.initialiseLayer()}}}])})();(function(){var a=angular.module("gawebtoolkit.vendor.google-layers",["gawebtoolkit.core.layer-services"]);a.directive("gaGoogleLayer",["$timeout","$compile","GALayerService","$log",function(e,d,b,g){var f=["street","hybrid","satellite","terrain"];var c=function(k){for(var h=0;h<f.length;h++){var j=f[h];if(j===k.toLowerCase()){return true}}return false};return{restrict:"E",require:"^gaMap",scope:{layerType:"@",visibility:"@",controllerEmitEventName:"@"},transclude:false,controller:["$scope",function(i){var h=this;if(i.controllerEmitEventName){i.$emit(i.controllerEmitEventName,h)}return h}],link:function(p,k,o,h){p.framework=h.getFrameworkVersion();p.mapAPI={};p.mapAPI.mapController=h;var m={},l;m=b.defaultLayerOptions(o,p.framework);m.layerType=m.layerType||m.googleLayerType;if(!c(m.layerType)){g.warn("Invalid Google layer type - "+m.layerType+' used. Defaulting to "Hybrid". Specify default Google layer type in "ga.config" - googleLayerType');m.layerType="Hybrid"}var n=function(){p.layerReady=true};var j=function(){p.constructionInProgress=true;m.mapElementId=h.getMapElementId();g.info("Google "+p.layerType+" - constructing...");l=b.createGoogleLayer(m,p.framework);h.addLayer(l).then(function(q){p.layerDto=q;n();g.info("construction complete...");p.constructionInProgress=false},function(q){p.$emit(m.layerName+"_error",m);p.onError({message:q,layer:m});n();g.info("construction failed...");p.constructionInProgress=false})};o.$observe("visibility",function(){if(p.layerReady&&h&&p.layerDto!=null&&p.layerDto.id){h.setLayerVisibility(p.layerDto.id,p.visibility==="true"||p.visibility===true)}});o.$observe("layerType",function(){if(p.layerReady&&h&&p.layerDto!=null&&p.layerDto.id){p.initialiseLayer()}});p.initCount=0;function i(){g.info("reconstructing layer...");var q=h.getLayers();var s=null;for(var r=0;r<q.length;r++){if(q[r].id===p.layerDto.id){s=r;break}}if(s!=null){h.removeLayerById(p.layerDto.id);p.layerDto=null;m=b.defaultLayerOptions(o,p.framework);m.initialExtent=h.getInitialExtent();m.format=p.format;l=b.createGoogleLayer(m,p.framework);h.addLayer(l).then(function(t){p.layerDto=t;n();if(p.layerDto!=null){var u=s-h.getLayers().length+1;h.raiseLayerDrawOrder(p.layerDto.id,u)}})}}p.initialiseLayer=function(){g.info("initialising layer...");if(p.layerDto!=null){i()}else{if(p.layerReady&&p.constructionInProgress){g.info("...")}else{j()}}};p.$on("$destroy",function(){if(p.layerDto){h.removeLayerById(p.layerDto.id)}$(window).off("resize.Viewport")});p.initialiseLayer()}}}])})();(function(){var a=angular.module("gawebtoolkit.vendor.osm-layers",["gawebtoolkit.core.layer-services"]);a.directive("gaOsmLayer",["$timeout","$compile","GALayerService","$log",function(d,c,b,e){return{restrict:"E",require:"^gaMap",scope:{wrapDateLine:"@",visibility:"@",controllerEmitEventName:"@"},transclude:false,controller:["$scope",function(g){var f=this;if(g.controllerEmitEventName){g.$emit(g.controllerEmitEventName,f)}return f}],link:function(n,i,m,f){n.framework=f.getFrameworkVersion();n.mapAPI={};n.mapAPI.mapController=f;var k={},j;k=b.defaultLayerOptions(m,n.framework);var l=function(){n.layerReady=true};var h=function(){n.constructionInProgress=true;k.mapElementId=f.getMapElementId();e.info("OpenStreetMaps Cycle - constructing...");j=b.createOsmLayer(k,n.framework);f.addLayer(j).then(function(o){n.layerDto=o;l();e.info("construction complete...");n.constructionInProgress=false},function(o){n.$emit(k.layerName+"_error",k);n.onError({message:o,layer:k});l();e.info("construction failed...");n.constructionInProgress=false})};m.$observe("visibility",function(){if(n.layerReady&&f&&n.layerDto!=null&&n.layerDto.id){f.setLayerVisibility(n.layerDto.id,n.visibility==="true")}});n.initCount=0;function g(){e.info("reconstructing layer...");var o=f.getLayers();var q=null;for(var p=0;p<o.length;p++){if(o[p].id===n.layerDto.id){q=p;break}}if(q!=null){f.removeLayerById(n.layerDto.id);n.layerDto=null;k=b.defaultLayerOptions(m,n.framework);k.initialExtent=f.getInitialExtent();k.format=n.format;j=b.createLayer(k,n.framework);f.addLayer(j).then(function(r){n.layerDto=r;l();if(n.layerDto!=null){var s=q-f.getLayers().length+1;f.raiseLayerDrawOrder(n.layerDto.id,s)}})}}n.initialiseLayer=function(){e.info("initialising layer...");if(n.layerDto!=null){g()}else{if(n.layerReady&&n.constructionInProgress){e.info("...")}else{h()}}};n.$on("$destroy",function(){if(n.layerDto){f.removeLayerById(n.layerDto.id)}$(window).off("resize.Viewport")});n.initialiseLayer()}}}])})();(function(){angular.module("gawebtoolkit.vendor-layers",["gawebtoolkit.vendor.google-layers","gawebtoolkit.vendor.bing-layers","gawebtoolkit.vendor.osm-layers"])})();